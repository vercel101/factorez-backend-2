(()=>{var e={4649:(e,t,s)=>{const a=s(2167),r=(s(6517),s(7096)),d=s(4555);e.exports={sentOTP:async(e,t)=>{try{let{mobile:s}=e.body;const n="A78cd4e6b7179e5439caac3c9f5f75b63",o="HXIN1777665894IN",i="OTP",u="FCTREZ";let l=function(e){let t="";for(let e=0;e<4;e++)t+="0123456789"[Math.floor(10*Math.random())];return t}();const c={method:"POST",url:`https://api.kaleyra.io/v1/${o}/messages`,headers:{"Content-Type":"application/x-www-form-urlencoded","api-key":n},data:`to=91${s}&type=${i}&sender=${u}&body=Your OTP Code for registration on factorez is ${l}. Thank you for Signup on FactorEz.com&template_id=1007482403267557324`},m=await a(c);l=await r.hash(l,10);let p=new d({mobile:s,otp:l});return await p.save(),t.status(200).send({status:!0,message:"OTP sent successfully",data:m.data})}catch(e){return console.log("Error sending SMS:",e.message),t.status(401).send({status:!1,message:e.message})}},verifyOTP:async(e,t)=>{try{let{mobile:s,OTP:a}=e.body,n=await d.find({mobile:s});if(!n.length)return t.status(401).send({status:!1,message:"You are using an expired OTP"});let o=n[n.length-1],i=r.compare(a,o.otp);return o.mobile===s&&i?(await d.deleteMany({mobile:o.mobile}),t.status(200).send({status:!0,message:"User verified"})):t.status(401).send({status:!1,message:"Authentication failed"})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},5950:(e,t,s)=>{const a=s(7489),r=s(9344),d=s(7096),{listOfRoleEnums:n,roleEnums:o}=s(489),{adminSecretKey:i,tokenSecretKey:u}=s(341),l=s(2545),{isValid:c,isValidEmail:m}=(s(5341),s(8512),s(6150),s(5484)),p=s(9074);e.exports={addAdmin:async(e,t)=>{try{let{name:s,email:r,phone:n,password:o,role:i}=e.body;if((await a.find({$or:[{email:r},{phone:n}]})).length>0)return t.status(400).send({message:"Email or Password already exists",status:!1});if(""===s)return t.status(400).send({message:"Name is required",status:!1});if(""===r)return t.status(400).send({message:"Email is required",status:!1});if(""===n)return t.status(400).send({message:"Phone number is required",status:!1});if(""===o)return t.status(400).send({message:"Password is required",status:!1});if(""===i)return t.status(400).send({message:"Admin Role is required",status:!1});o=await d.hash(o,10);let u={name:s,email:r.toLowerCase(),password:o,role:i,phone:n,isDeleted:!1},l=await a.create(u);return l.password=void 0,l.isSuperAdmin=void 0,t.status(201).send({status:!0,message:"Successful",data:l})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getAllAdmin:async(e,t)=>{let s=await a.find({isSuperAdmin:!1,isDeleted:!1}).select(["-password","-isSuperAdmin"]);return t.status(200).send({status:!0,message:"All admins",data:s})},createSuperAdmin:async(e,t)=>{try{let{name:s,email:r,phone:n,password:o}=e.body;if(e.params.secretKey===i){if((await a.find({$or:[{email:r},{phone:n}]})).length>0)return t.status(400).send({message:"Email or Password already exists",status:!1});if(""===s)return t.status(400).send({message:"Name is required",status:!1});if(""===r)return t.status(400).send({message:"Email is required",status:!1});if(""===n)return t.status(400).send({message:"Phone number is required",status:!1});if(""===o)return t.status(400).send({message:"Password is required",status:!1});o=await d.hash(o,10);let e={name:s,email:r.toLowerCase(),password:o,role:["ADMIN"],phone:n,isSuperAdmin:!0,isDeleted:!1},i=await a.create(e);return i.password=void 0,i.isSuperAdmin=void 0,t.status(201).send({status:!0,message:"Successful",data:i})}return t.status(401).send({status:!0,message:"Invalid signature"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},adminLogin:async(e,t)=>{try{let{email:s,password:n}=e.body;if(!c(s))return t.status(400).send({status:!1,message:"Email or USER Id is required"});if(s.includes("@")&&!m(s))return t.status(400).send({status:!1,message:"Invalid email"});if(!c(n))return t.status(400).send({status:!1,message:"password is required"});let o=null;if(s.includes("@")?(o=await a.findOne({email:s.toLowerCase(),isDeleted:!1}),o||(o=await l.findOne({emailId:s.toLowerCase()}))):o=await l.findOne({vendor_unique_id:s}),!o)return t.status(400).send({status:!1,message:"Invalid Email id or Username"});d.compare(n,o.password,(function(e,s){if(e)return t.status(400).send({status:!1,message:e.message});!function(e){if(e){let e=Date.now(),s={},a="isSuperAdmin"in o;if(!a){if("Pending"===o.status||"Inprogress"===o.status)return t.status(401).send({status:!1,message:"Account is under review"});if("Rejected"===o.status)return t.status(401).send({status:!1,message:"Account has been Rejected, Please contact us."})}a?(s.name=o.name,s.email=o.email,s.userType=o.isSuperAdmin?"Super Admin":"Admin",s.role=o.role,s.phone=o.phone,s.photo=o.profileUrl,s.vendorId=null):(s.name=o.representativeName,s.email=o.emailId,s.userType="Seller",s.role=o.role,s.altMobileNo=o.altMobileNo,s.phone=o.mobileNo,s.photo=o.profileUrl,s.vendorId=o.vendor_unique_id);let d=Math.floor(e/1e3),n=r.sign({email:s.email,userId:o._id.toString(),userModel:a?"ADMIN":"VENDOR",iat:d},u,{expiresIn:"12h"});return s.token=n,t.setHeader("Authorization","Bearer",n),t.status(200).send({status:!1,message:"Successfully logged in",data:s})}t.status(401).send({status:!1,message:"Incorrect Password"})}(s)}))}catch(e){return t.status(500).send({status:!1,message:e.message})}},getAllSubadminEnums:async(e,t)=>{try{return t.status(200).send({status:!0,message:"Data Accessed",data:o})}catch(e){return t.status(500).send({status:!1,message:e.message})}},verifyVendor:async(e,t)=>{try{let{vendorMargin:s,vendorStatus:a}=e.body,r=await l.findById(e.params.vendorId);return"Approved"===a?(s&&(r.marginInPercentage=s),r.status=a,r.actionTakenBy=e.userId,await p.updateMany({vendor_id:r._id},{$set:{margin:s}}),await r.save()):"Rejected"===a?(r.status=a,r.actionTakenBy=e.userId,await r.save()):(s&&(await p.updateMany({vendor_id:r._id},{$set:{margin:s}}),r.marginInPercentage=s),await r.save()),t.status(200).send({status:!0,message:"Vendor Updated",data:"Updated"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},deleteVendor:async(e,t)=>{try{let{vendorId:s}=e.body;if(!s)return t.status(400).send({status:!1,message:"bad request"});let a=await l.findById(s);return a?(a.isDeleted=!0,await a.save(),t.status(202).send({status:!0,message:"vendor deleted successfully"})):t.status(400).send({status:!1,message:"vendor not found"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},changeVendorPassword:async(e,t)=>{try{let{vendorId:s,newPassword:a}=e.body,r=await l.findOne({_id:s});if(!r)return t.status(404).send({status:!1,message:"Vendor Not Found"});if(""===a)return t.status(400).send({message:"Password is required",status:!1});let n=await d.hash(a,10);return r.password=n,await r.save(),t.status(201).send({message:"Password updated",status:!0})}catch(e){return t.status(500).send({status:!1,message:e.message})}},updateAdminInfo:async(e,t)=>{try{let s=e.params.adminid,{phone:r,password:n,email:o,name:i,role:u}=e.body,l=await a.findOne({_id:s,isDeleted:!1});if(!l)return t.status(400).send({status:!1,message:"Bad request"});if(r&&(l.phone=r),o&&(l.email=o.toLowerCase()),i&&(l.name=i),u&&(l.role=u),n){let e=await d.hash(n,10);l.password=e}return await l.save(),t.status(202).send({status:!0,message:"Admin Updated"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},deleteAdminById:async(e,t)=>{try{let s=e.params.adminid,r=await a.findById(s);return r?(r.isDeleted=!0,await r.save(),t.status(202).send({status:!0,message:"Admin Deleted"})):t.status(400).send({status:!1,message:"Bad request"})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},3241:(e,t,s)=>{const a=s(9074),r=s(6443),d=s(2545),n=s(272),o=e=>(e.setHours(0,0,0,0),e.getTime()),i=()=>{var e=new Date,t=new Date(e.getFullYear(),0,1),s=new Date(e.getFullYear(),12,0);return[t.getTime(),s.getTime()]},u=()=>{var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),s=new Date(e.getFullYear(),e.getMonth()+1,0);return[t.getTime(),s.getTime()]},l=()=>{var e=new Date;e.setHours(0,0,0,0);var t=e.getDate()-e.getDay(),s=t+6,a=new Date(e.setDate(t)),r=new Date(e.setDate(s));return console.log(a),console.log(r),[a.getTime(),r.getTime()]};e.exports={getDashboardData:async(e,t)=>{try{let e=await a.find({isDeleted:!1}).populate("vendor_id"),s=0,c=0,m=0,p=0,g=0,y=0,_=0,f=0,h=0,I=0,A=0,b=0,S=0;for(let t of e)"Active"===t.vendor_id.isActive&&s++;c+=(await r.find({isDeleted:!1})).length,m+=(await d.find({isActive:"Active"})).length;let N=o(new Date),D=await n.find().populate("order_status_id");for(let e of D)console.log(e),o(e.order_date)===N&&(g++,"PENDING"!==e.order_status_id.status&&"CANCELLED"!==e.order_status_id.status&&(S+=e.grand_total)),o(e.order_date)>=l()[0]&&o(e.order_date)<=l()[1]&&(y++,"PENDING"!==e.order_status_id.status&&"CANCELLED"!==e.order_status_id.status&&(A+=e.grand_total)),o(e.order_date)>=u()[0]&&o(e.order_date)<=u()[1]&&(_++,"PENDING"!==e.order_status_id.status&&"CANCELLED"!==e.order_status_id.status&&(I+=e.grand_total)),o(e.order_date)>=i()[0]&&o(e.order_date)<=i()[1]&&(f++,"PENDING"!==e.order_status_id.status&&"CANCELLED"!==e.order_status_id.status&&(h+=e.grand_total)),"PENDING"!==e.order_status_id.status&&"CANCELLED"!==e.order_status_id.status&&(b+=e.grand_total),p++;let v={productCount:s,customerCount:c,vendorCount:m,todayOrderCount:g,thisWeakOrderCount:y,thisMonthOrderCount:_,thisYearOrderCount:f,thisYearSale:h,thisMonthSale:I,thisWeekSale:A,todaySale:S,overAllSale:b,overallOrder:p};return t.status(200).send({status:!0,data:{...v},message:"Dashboard data fetched"})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},3749:(e,t,s)=>{const a=s(6150),r=s(2545),{isValid:d}=s(5484),{isValidObjectId:n}=s(1185),{uploadFile:o}=(s(9074),s(8913));e.exports={addBrand:async(e,t)=>{try{let s=e.body,{brand_name:n,vendor_id:i,brandLogo:u}=s;if(!d(n))return t.status(400).send({status:!1,message:"Brand Name is required"});if(await a.findOne({brand_name:n}))return t.status(400).send({status:!1,message:"This category is already exists, please enter a new category"});let l=await r.findOne({vendor_unique_id:i}),c=null;c=e.files?await o(e.files.brandLogo):u;let m={brand_name:n,vendor_id:l,brandLogo:c},p=await a.create(m);return l.brand_id.push(p),await l.save(),t.status(201).send({status:!0,message:"success",data:p})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getAllBrands:async(e,t)=>{try{let s=null;return s="VENDOR"===e.userModel?await a.find({isDeleted:!1,vendor_id:e.userId}).populate("vendor_id"):await a.find({isDeleted:!1}).populate("vendor_id"),t.status(200).send({status:!0,data:s})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getAllBrandByVendor:async(e,t)=>{try{if("VENDOR"===e.userModel){let s=await r.findOne({vendor_unique_id:e.params.vendorId}).populate("brand_id");return s?t.status(200).send({status:!0,data:s.brand_id}):t.status(400).send({status:!1,message:"Vendor Not Found"})}return t.status(400).send({status:!1,message:"Bad Request"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},verifyBrandById:async(e,t)=>{try{let s=e.params.brandId,r=e.body.brandStatus;if("Super Admin"===e.userModel||"ADMIN"===e.userModel){let e=await a.findById(s);return e?(e.brandStatus=r,await e.save(),t.status(202).send({status:!0,data:"Brand status change successfully"})):t.status(400).send({status:!1,data:"Bad request"})}return t.status(400).send({status:!1,data:"Bad request"})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},6795:(e,t,s)=>{const a=s(6756),{isValid:r}=s(5484),{uploadFile:d,uploadImage:n}=s(8913),o=s(9359);e.exports={addBusinessInfo:async(e,t)=>{try{let{bName:s,bEmail:r,bNumber:d}=e.body;if(!s||!r||!d)return t.status(400).send({status:!1,message:"All fields are required"});let n={business_name:s,contactNo:d,contactEmail:r};console.log(n);let o=await a.find();return console.log(o),o.length>0?(o[0].business_name=s,o[0].contactNo=d,o[0].contactEmail=r,await o[0].save()):await a.create(n),t.status(201).send({status:!0,message:"Success",data:"business"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},addBusinessGST:async(e,t)=>{try{let{gsts:s}=e.body;if(!s||0===s.length)return t.status(400).send({status:!1,message:"Add GST"});let r=await a.find();return 0===r.length?t.status(400).send({status:!1,message:"Add business Name and other fields then add GST"}):(r[0].gsts=s,r[0].defaultGST={},await r[0].save(),t.status(201).send({status:!0,message:"GST updated to business"}))}catch(e){return t.status(500).send({status:!1,message:e.message})}},getBusinessInfo:async(e,t)=>{try{let e=await a.find();return 0===e.length?t.status(400).send({status:!1,message:"No record available"}):t.status(200).send({status:!0,message:"Record fetched...",data:e[0]})}catch(e){return t.status(500).send({status:!1,message:e.message})}},addBusinessFiles:async(e,t)=>{try{let{bLogo:s,bInvLogo:r,bPolicy:n,bTC:o}=e.files,i=await a.find();return s&&(i[0].business_Logo=await d(s)),r&&(i[0].invoiceLogo=await d(r)),n&&(i[0].privacyPolicy=await d(n)),o&&(i[0].iAgree=await d(o)),await i[0].save(),t.status(201).send({status:!0,message:"Success",data:"business"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},setDefaultGst:async(e,t)=>{try{let{gst:s}=e.body,r=await a.find();if(0===r.length)return t.status(400).send({status:!1,message:"No record available"});for(let e of r[0].gsts)console.log(e),e.gstNo===s&&(r[0].defaultGST.gstNo=e.gstNo,r[0].defaultGST.pickupAddress=e.pickupAddress,r[0].defaultGST.stateCode=e.stateCode);return await r[0].save(),console.log(e.body),t.status(200).send({status:!0,message:"Default gst updated..."})}catch(e){return t.status(500).send({status:!1,message:e.message})}},saveSocialMedia:async(e,t)=>{try{let{facebook:s,instagram:r,twitter:d,youtube:n,linkedin:o}=e.body,i=await a.find();return 0===i.length?t.status(400).send({status:!1,message:"No record available"}):(s&&(i[0].socialMedia.facebook=s),r&&(i[0].socialMedia.instagram=r),d&&(i[0].socialMedia.twitter=d),n&&(i[0].socialMedia.youtube=n),o&&(i[0].socialMedia.linkedin=o),await i[0].save(),t.status(200).send({status:!0,message:"Social media links added"}))}catch(e){return t.status(500).send({status:!1,message:e.message})}},bannerForClientPage:async(e,t)=>{try{let{images:s}=e.files,{type:a}=e.body;if(s&&a)if("MULTIPLE"===a)for await(let e of s){let t=(await n(e)).imageURL;await o.create({bannerUrl:t,type:"MULTIPLE"})}else if("SINGLE"===a){let e=(await n(s)).imageURL;await o.create({bannerUrl:e,type:"SINGLE"})}return t.status(200).send({status:!0,message:"Banner added"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getBannerForClientPage:async(e,t)=>{try{let e=await o.find();return t.status(200).send({status:!0,data:e,message:"Banner Images fetched"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},bannerDeleteById:async(e,t)=>{try{let s=e.params.bannerId;return await o.findByIdAndDelete(s),t.status(200).send({status:!0,message:"Banner deleted successfully"})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},6548:(e,t,s)=>{const a=s(2930),{isValidObjectId:r}=(s(4204),s(272),s(1185));e.exports={addCancelledReason:async(e,t)=>{try{let s=e.body,{questions:r,customerAnswer:d}=s,n={questions:r,customerAnswer:d},o=await a.create(n);return t.status(201).send({status:!0,message:"Success",data:o})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},8329:(e,t,s)=>{const{isValidObjectId:a}=s(1185),r=s(1277),d=s(9074),{isValid:n}=s(5484),o=s(6421),i=s(6443);e.exports={addToCart:async(e,t)=>{try{let s=e.params.customerId,{product_id:n,qty:u,lotSize:l,colorId:c}=e.body;if(!a(s))return t.status(400).send({status:!1,message:"Invalid Customer ID"});if(!a(c))return t.status(400).send({status:!1,message:"Invalid Color ID"});let m=await r.findOne({customer_id:s}),p=await i.findById(s),g=await o.findById(c);if(!await d.findOne({_id:n,status:"Approved"}))return t.status(404).send({status:!1,message:"Product not found"});let y={product_id:n,qty:Number(u),lotSize:l,color:{colorName:g.colorName,colorHex:g.colorHex}};if(!m)return t.status(400).send({status:!1,message:"Server Error"});y.addedAt=(new Date).toLocaleString(),m.products.push(y),await m.save();let _={name:p.name,email:p.email,customerId:p._id.toString(),userType:"CUSTOMER",isActivated:p.isActivated,phone:p.phone,cartLength:m.products.length};t.status(201).send({status:!0,message:"Cart updated successfully",data:_})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getAllAbandentCarts:async(e,t)=>{try{let e=await r.find({products:{$gte:[{$size:0}]}}).populate(["customer_id",{path:"products.product_id",model:"Product"}]);return t.status(200).send({status:!0,data:e})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getCartByCustomerId:async(e,t)=>{try{let s=e.params.customerId,a=await r.findOne({customer_id:s}).populate({path:"products.product_id",model:"Product",populate:{path:"brandId",model:"Brand"}});if(!a)return t.status(404).send({status:!1,message:"No cart found with this customer"});let d=await i.findById(s),n={name:d.name,email:d.email,customerId:d._id.toString(),userType:"CUSTOMER",isActivated:d.isActivated,phone:d.phone,cartLength:a.products.length};return t.status(200).send({status:!0,data:a,customerData:n})}catch(e){return t.status(500).send({status:!1,message:e.message})}},removeFromCart:async(e,t)=>{try{let s=e.params.customerId,a=e.params.index,d=await r.findOne({customer_id:s});if(!d)return t.status(400).send({status:!1,message:"Bad request"});if(d.products.length>0){let e=d.products;e.splice(a,1),d.products=e,await d.save()}t.status(201).json({message:"Product removed successfully"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},qtyIncreaseDecrease:async(e,t)=>{try{let s=e.params.customerId,a=e.params.index,d=e.params.qty,n=await r.findOne({customer_id:s}).populate("products.product_id");if(!n)return t.status(400).send({status:!1,message:"Bad request"});if(!(n.products.length>0))return t.status(400).send({status:!1,message:"Bad request"});{n.products[a].qty=d;let e=(e=>{let t=0;return e.forEach((e=>{let{seller_price:s,margin:a,sellingGST:r}=e.product_id;t+=Number(e.qty)*Number(((e,t,s)=>{let a=Number(e)+Number(e)*Number(t)/100;return(Number(a)*Number(s)/100+a).toFixed(2)})(s,a,r))})),t.toFixed(2)})(n.products);console.log(e),n.currentCoupon&&e<n.currentCoupon.minOrderAmt&&(console.log("hell"),n.currentCoupon=void 0),await n.save()}return t.status(201).json({message:"Quantity updated"})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},5761:(e,t,s)=>{const a=s(7227),r=s(2115),{isValid:d}=(s(9074),s(5484)),{isValidObjectId:n}=s(1185);e.exports={addCategory:async(e,t)=>{try{let s=e.body,{category_name:n,subCategory:o}=s;if(!d(n))return t.status(400).send({status:!1,message:"category is required"});if(await a.findOne({category_name:n}))return t.status(400).send({status:!1,message:"This category is already exists, please enter a new category"});let i={category_name:n,sub_category:await r.insertMany(o)},u=await a.create(i);return t.status(201).send({status:!0,message:"success",data:u})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getAllCategories:async(e,t)=>{try{let e=await a.find({isDeleted:!1}).populate("sub_category");return t.status(200).send({status:!0,data:e})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getCategoryById:async(e,t)=>{try{let s=e.params.categoryId;if(!n(s))return t.status(400).send({status:!1,message:"Invalid categoryId"});let r=await a.findOne({_id:s,isDeleted:!1});return r?t.status(200).send({status:!0,message:"success",data:r}):t.status(404).send({status:!1,message:"Category not found"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},updateCategoryById:async(e,t)=>{try{let s=e.params.categoryId;if(!n(s))return t.status(400).send({status:!1,message:"invalid category id"});let d=await a.findOne({_id:s}).populate("sub_category");if(!d)return t.status(404).send({status:!1,message:"Category not found"});let{category_name:o,subCategory:i}=e.body;console.log(i,"sub category1"),console.log(d.sub_category,"sub category2"),d.sub_category.forEach((async e=>{let t=!1;i.forEach((s=>{s.hasOwnProperty("_id")&&s._id===e._id.toHexString()&&(t=!0)})),t||(console.log(e._id),await r.findOneAndUpdate({_id:e._id,isDeleted:!1},{isDeleted:!0,deletedAt:Date.now()},{new:!0}))}));let u=[];for(const e of i)if(e.hasOwnProperty("_id"))u.push(e);else{let t=await r.create(e);u.push(t)}return d.category_name=o,d.sub_category=u,console.log(u,"crate arr"),await d.save(),t.status(200).send({status:!0,message:"success",data:"Category updated successfully"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},deleteCategoryById:async(e,t)=>{try{let s=e.params.categoryId;return n(s)?await a.findOne({_id:s})?await a.findOneAndUpdate({_id:s,isDeleted:!1},{isDeleted:!0,deletedAt:new Date},{new:!0})?t.status(200).send({status:!0,message:"success"}):t.status(404).send({status:!1,message:"category not found or already deletec"}):t.status(404).send({status:!1,message:"Category not found"}):t.status(400).send({status:!1,message:"Invalid category id"})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},4976:(e,t,s)=>{const a=s(6421);e.exports={addNewColor:async(e,t)=>{try{let{colorName:s,colorHex:r}=e.body;return""===s?t.status(400).send({message:"Color Name is required",status:!1}):""===r?t.status(400).send({message:"Color Hex is required",status:!1}):(await a.find({$or:[{colorName:s},{colorHex:r}]})).length>0?t.status(400).send({message:"This color is already exists",status:!1}):(await a.create({colorName:s,colorHex:r}),t.status(201).send({status:!0,message:"Color added successfully"}))}catch(e){return t.status(500).send({status:!1,message:e.message})}},deleteColorById:async(e,t)=>{try{let s=e.params.colorId,r=await a.findById(s);return r?(r.isDeleted=!0,await r.save(),t.status(202).send({status:!0,message:"Color deleted successfully"})):t.status(400).send({status:!1,message:"Bad Request"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getAllColor:async(e,t)=>{try{let e=await a.find({isDeleted:!1});return t.status(200).send({status:!0,message:"Color fetched successfully",data:e})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},8147:(e,t,s)=>{const a=s(6632),r=s(6443),{isValidObjectId:d}=s(1185),{isExpiryCoupon:n}=s(4289);e.exports={generateCoupon:async(e,t)=>{try{let{couponCode:s,validTill:r,maxUsers:d,maxDiscPrice:n,discountType:o,discountAmt:i,minOrderAmt:u}=e.body;if(!s||""===s)return t.status(400).send({status:!1,message:"Coupon code required"});if(!r||""===r)return t.status(400).send({status:!1,message:"Coupon expiry date required"});if(!d||0===Number(d))return t.status(400).send({status:!1,message:"Coupon uses limit is required"});if(!i||0===Number(i))return t.status(400).send({status:!1,message:"Coupon discount amount is required"});if(!o||""===o)return t.status(400).send({status:!1,message:"Coupon discount type is required"});if(!u||""===u)return t.status(400).send({status:!1,message:"Minimum order is required"});if("Percentage"===o&&(!n||0===Number(n)))return t.status(400).send({status:!1,message:"Coupon Maximum discount price is required"});if(await a.findOne({couponCode:s,isDeleted:!1}))return t.status(200).send({status:!1,message:"This coupon code is already created"});let l={couponCode:s,validTill:new Date(r),maxUsers:d,maxDiscPrice:n,discountType:o,discountAmt:i,minOrderAmt:u};"PRICE"===o&&(l.maxDiscPrice=i);let c=await a.create(l);t.status(201).send({status:!0,message:"Coupon created successfully...",data:c})}catch(e){return t.status(500).send({status:!1,message:e.message})}},applyCoupon:async(e,t)=>{try{let s=e.params.customerid,{couponCode:n,orderAmount:o}=e.body;if(!n||""===n)return t.status(400).send({status:!1,message:"Coupon id required"});if(!o||""===o)return t.status(400).send({status:!1,message:"Order Amount required"});if(!d(s))return t.status(400).send({status:!1,message:"Invalid Request"});if(!await r.findById(s).populate("cart_id"))return t.status(400).send({status:!1,message:"Bad request"});let i=await a.findOne({couponCode:n,isDeleted:!1});if(!i)return t.status(400).send({status:!1,message:"Invalid Coupon Code"});if(i.isExpired)return t.status(200).send({status:!1,message:"Coupon code expired"});if(i.isUsed)return t.status(200).send({status:!1,message:"Coupon code uses has exceed to its maximum limit"});if(i.minOrderAmt>o)return t.status(200).send({status:!1,message:`This coupon is applicable for Minimum order amount ${i.minOrderAmt}`});let u=i.validTill.getDate(),l=i.validTill.getMonth()+1,c=i.validTill.getFullYear(),m=new Date(`${c}-${l<10?"0"+l:l}-${u<10?"0"+u:u}`).getTime()/1e3,p=(Date.now(),new Date),g=`${p.getFullYear()}-${p.getMonth()+1<10?"0"+(p.getMonth()+1):p.getMonth()+1}-${p.getDate()<10?"0"+p.getDate():p.getDate()}`;return new Date(g).getTime()/1e3<=m?i.customer_id.includes(s)?t.status(200).send({status:!1,message:"Coupon Already applied"}):i.customer_id.length>=i.maxUsers&&!1===i.isUsed?(i.isUsed=!0,await i.save(),t.status(200).send({status:!1,message:"Coupon code uses has exceed to its maximum limit"})):t.status(202).send({status:!0,data:i.discountAmt,message:"Coupon applied successfully..."}):(i.isExpired=!0,await i.save(),t.status(200).send({status:!1,message:"Coupon code expired"}))}catch(e){return t.status(500).send({status:!1,message:e.message})}},getAllCoupons:async(e,t)=>{try{let e=await a.find({isDeleted:!1}).sort({createdAt:-1}).populate("customer_id");for(let t of e)t.isExpired||n(t.validTill)&&(t.isExpired=!0,await t.save());t.status(200).send({status:!0,message:"All Coupons fetched successfully...",data:e})}catch(e){return t.status(500).send({status:!1,message:e.message})}},deleteCoupon:async(e,t)=>{try{let s=e.params.couponid,r=await a.findById(s);return r?(r.isDeleted=!0,await r.save(),t.status(202).send({status:!0,message:"Coupon deleted successfully"})):t.status(400).send({status:!1,message:"Bad request"})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},6052:(e,t,s)=>{const{isValidObjectId:a}=s(1185),r=s(4935),d=s(6443),{isValidRequestBody:n,isValid:o}=s(5484),{stateAndCode:i}=s(8357),u=s(1277),l=s(7096);e.exports={addCustomerInformation:async(e,t)=>{try{let s=e.body,n=e.params.customerid,{name:c,alternate_phone:m,gstNo:p,email:g,pincode:y,password:_,address:f,state:h,city:I}=s;if(!o(n))return t.status(400).send({status:!1,message:"Bad request"});if(!a(n))return t.status(400).send({status:!1,message:"Bad request"});if(!(h&&c&&y&&I&&_&&f))return t.status(400).send({status:!1,message:"Please provide all required fields"});let A={customerId:n,address:f,state:h,pincode:y,city:I};if(!Object.keys(i).includes(h))return t.status(400).send({status:!1,message:"Invalid State"});A.stateCode=i[h];let b=await d.findOne({_id:n,isDeleted:!1,isBlocked:!1});if(!b)return t.status(400).send({status:!1,message:"Bad request"});let S=await l.hash(_,10);if(b.name=c,b.password=S,p&&(b.gstNo=p),m&&(b.alternate_phone=m),g&&(b.email=g),!0===b.isActivated)return t.status(400).send({status:!1,message:"Account is already active"});let N=await u.create({customer_id:b._id});if(!N)return t.status(500).send({status:!1,message:"Internal Server Error"});b.cart_id=N,b.isActivated=!0,A.customerId=b;let D=await r.create(A);return b.defaultAddress=D._id,await b.save(),t.status(201).send({status:!0,message:"Successfully registered"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getAllAddresses:async(e,t)=>{try{let s=e.params.customerId;if(!s)return t.status(400).send({status:!1,message:"Customer id is required in params"});let a=await r.find({customerId:s,isDeleted:!1});return t.status(200).send({status:!0,data:a})}catch(e){return t.status(500).send({status:!1,message:e.message})}},updateAddressByCustomerId:async(e,t)=>{try{let s=e.params.customerId;if(!s)return t.status(400).send({status:!1,message:"Please provide the customerId in params"});let a=await r.findOne({customerId:s});if(!a)return t.status(404).send({status:!1,message:"Customer not found"});let d=e.body;if(!n(d))return t.status(400).send({status:!1,message:"Please enter data in body"});if("address"in d)for(let e=0;e<a.address.length;e++)a.address[e]=d.address[e];return await a.save(),t.status(200).send({status:!0,message:"Address updated successfully",data:a})}catch(e){return t.status(500).send({status:!1,message:e.message})}},deleteAddressById:async(e,t)=>{try{let s=e.params.customerId,n=e.params.addressId;if(!a(s))return t.status(400).send({status:!1,message:"Invalid Customer id"});if(!a(n))return t.status(400).send({status:!1,message:"Invalid address id"});let o=await r.findById(n),i=await d.findById(s);if(!i)return t.status(404).send({status:!1,message:"customer not found with this id"});if(!o)return t.status(404).send({status:!1,message:"address not found with this id"});o.isDeleted=!0,await o.save(),i.defaultAddress.toString()===n&&(i.defaultAddress=void 0,i.save());let u={name:i.name,email:i.email,customerId:i._id.toString(),userType:"CUSTOMER",isActivated:i.isActivated,phone:i.phone};return i.profileUrl&&(u.photo=i.profileUrl),i.alternate_phone&&(u.altMobileNo=i.alternate_phone),i.gstNo&&(u.gstNo=i.gstNo),i.defaultAddress&&(u.defaultAddressId=i.defaultAddress._id.toString()),t.status(200).send({status:!0,data:u,message:"Address deleted successfully"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},addAddress:async(e,t)=>{try{let{address:s,state:n,city:o,pincode:i,stateCode:u}=e.body,l=e.params.customerId;return a(l)?s&&n&&o&&i&&u?await d.findById(l)?(await r.create({customerId:l,address:s,state:n,city:o,pincode:i,stateCode:u}),t.status(201).send({status:!0,message:"Address created"})):t.status(400).send({status:!1,message:"Customer not found"}):t.status(400).send({status:!1,message:"All fields are requited"}):t.status(400).send({status:!1,message:"Bad request"})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},3842:(e,t,s)=>{const a=s(6443),r=(s(1277),s(9344)),d=s(7096),{isValid:n,isValidMoblie:o,isValidEmail:i,isValidPassword:u}=s(5484),{customerTokenSecretKey:l}=s(341),{isValidObjectId:c}=s(1185),m=s(4935),p=s(752);e.exports={loginUser:async(e,t)=>{try{let{phone:s,password:n}=e.body;if(!s||!n)return t.status(400).send({status:!1,message:"Bad request"});let o=await a.findOne({phone:s,isDeleted:!1}).populate("cart_id");if(!o)return t.status(404).send({status:!1,message:"Account not found this mobile number, you have to register first"});let i=await p.find({userId:o._id});if(o.isBlocked)return t.status(403).send({status:!1,message:"This account has been blocked, Please Contact us!"});d.compare(n,o.password,(function(e,s){if(e)return t.status(400).send({status:!1,message:e.message});!function(e){if(e){let e=Date.now(),s={name:o.name,email:o.email,customerId:o._id.toString(),userType:"CUSTOMER",isActivated:o.isActivated,phone:o.phone,cartLength:o.cart_id.products.length,wishlistLength:i.length};o.profileUrl&&(s.photo=o.profileUrl),o.alternate_phone&&(s.altMobileNo=o.alternate_phone),o.gstNo&&(s.gstNo=o.gstNo),o.defaultAddress&&(s.defaultAddressId=o.defaultAddress._id.toString());let a=Math.floor(e/1e3),d=r.sign({userId:o._id.toString(),phone:o.phone,userModel:"CUSTOMER",iat:a},l,{expiresIn:"24h"});return s.token=d,t.setHeader("Authorization","Bearer "+d),t.status(200).send({status:!0,message:"Login successfully",data:s})}t.status(401).send({status:!1,message:"Login denied"})}(s)}))}catch(e){return t.status(500).send({status:!1,message:e.message})}},getAllCustomer:async(e,t)=>{try{let e=await a.find({isDeleted:!1}).populate("defaultAddress");return t.status(200).send({status:!0,data:e})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getCustomerById:async(e,t)=>{try{let s=e.params.customerId,r=await a.findOne({_id:s});return r?t.status(200).send({status:!0,data:r}):t.status(404).send({status:!1,message:"Customer not found"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},updateCustomerById:async(e,t)=>{try{let s=e.params.customerId;if(!c(s))return t.status(400).send({status:!1,message:"Invalid Customer id"});let r=await a.findById(s);if(!r)return t.status(404).send({status:!1,message:"Customer not found"});let{name:n,gstNo:o,alternate_phone:i,email:u,password:l}=e.body;if(!n&&!o&&i&&u&&l)return t.status(400).send({status:!1,message:"At least one field is require to update your information"});if(n&&(r.name=n),o&&(r.gstNo=o),i&&(r.alternate_phone=i),u&&(r.email=u.toLowerCase()),l){let e=await d.hash(l,10);r.password=e}await r.save();let m={name:r.name,email:r.email,customerId:r._id.toString(),userType:"CUSTOMER",isActivated:r.isActivated,phone:r.phone};return r.profileUrl&&(m.photo=r.profileUrl),r.alternate_phone&&(m.altMobileNo=r.alternate_phone),r.gstNo&&(m.gstNo=r.gstNo),r.defaultAddress&&(m.defaultAddressId=r.defaultAddress._id.toString()),t.status(200).send({status:!0,message:"Customer updated successfully",data:m})}catch(e){return t.status(500).send({status:!1,message:e.message})}},deleteCustomerById:async(e,t)=>{try{let s=e.params.customerId,r=await a.findOne({_id:s});return r?(r.isDeleted=!0,await r.save(),t.status(200).send({status:!0,message:"Customer deleted successfully"})):t.status(404).send({status:!1,message:"Customer not found"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},blockCustomerById:async(e,t)=>{try{let s=e.params.customerId,r=await a.findOne({_id:s});if(!r)return t.status(404).send({status:!1,message:"Customer not found"});r.isBlocked=!r.isBlocked,await r.save();let d=r.isBlocked?"Customer has been blocked":"Customer is now Active";return t.status(202).send({status:!0,message:d})}catch(e){return t.status(500).send({status:!1,message:e.message})}},findOrdersByPhone:async(e,t)=>{try{let{userPhone:s}=e.body,r=await a.findOne({phone:s}).populate({path:"orders",model:"Order",populate:[{path:"vendorId",model:"Vendor"},{path:"order_status_id",model:"Order_Status_Table"},{path:"ordered_products",model:"Ordered_Product"}]});if(!r)return t.status(404).send({status:!1,message:"Customer not found"});let d=r.orders;return t.status(200).send({status:!0,message:"Order fetch successfully",data:d})}catch(e){return t.status(500).send({status:!1,message:e.message})}},setDefaultAddress:async(e,t)=>{try{let s=e.params.customerId,r=e.params.addressId;if(!c(s))return t.status(400).send({status:!1,message:"Invalid Customer id"});if(!c(r))return t.status(400).send({status:!1,message:"Invalid address id"});let d=await m.findById(r),n=await a.findById(s);if(!d)return t.status(404).send({status:!1,message:"Address not found with this id"});if(!n)return t.status(404).send({status:!1,message:"Customer not found with this id"});n.defaultAddress=d._id,await n.save();let o={name:n.name,email:n.email,customerId:n._id.toString(),userType:"CUSTOMER",isActivated:n.isActivated,phone:n.phone};return n.profileUrl&&(o.photo=n.profileUrl),n.alternate_phone&&(o.altMobileNo=n.alternate_phone),n.gstNo&&(o.gstNo=n.gstNo),n.defaultAddress&&(o.defaultAddressId=n.defaultAddress._id.toString()),t.status(200).send({status:!0,data:o,message:"Default address updated"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},changePassword:async(e,t)=>{try{let s=e.params.customerId,{password:r}=e.body;if(!r)return t.status(400).send({status:!1,message:"Password is required"});if(!c(s))return t.status(400).send({status:!1,message:"Invalid Customer id"});let n=await a.findById(s);if(!n)return t.status(404).send({status:!1,message:"Customer not found with this id"});let o=await d.hash(r,10);return n.password=o,await n.save(),t.status(202).send({status:!0,message:"Password Updated"})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},3602:(e,t,s)=>{const a=s(5831),r=s(6756),d=s(7227),n=s(9074),o=s(6421);e.exports={getDashboardData:async(e,t)=>{try{let e=await a.find().populate(["featuredProduct","newArrival","bestSelling"]),s=await r.find(),n=await d.find().populate("sub_category"),i=await o.find();s[0].defaultGST=void 0,s[0].gsts=void 0;let u={recommendedProduct:e[0],storeInfo:s[0],category:n,color:i};return t.status(200).send({status:!0,message:"success",data:u})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getProductBySlug:async(e,t)=>{try{let s=e.params.slug,a=await n.findOne({slug:s,isDeleted:!1,stockStatus:"In_stock"}).populate(["color_id","categoryId","brandId","vendor_id"]);return a?t.status(200).send({message:"product info fetched",data:a}):t.status(200).send({message:"product info fetched",data:null})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},6791:(e,t,s)=>{const a=s(7641),r=s(8160);s(7101);const d=s(8910),n=s(2545),o=s(7227),i=s(6421),{uploadFile:u}=s(8913),l=s(9074),c=s(272),{dateToLocalDateTime:m}=s(4394),p=async(e,t,s)=>{let a={},r={},d="";if("ADMIN"===e.userModel&&(d=(await n.findOne({vendor_unique_id:s.vendor_id}).populate("brand_id"))._id),0===Object.keys(a).length){let e=await o.find();for(let t of e)a[t._id]=t.sub_category}if(0===Object.keys(r).length){let e=await i.find();for(let t of e)r[t._id]=t._id}if(""===s.brandId||""===s.color_id||""===s.categoryId||""===s.subCatId)return{status:!1,message:"Please Provide All Dependent Ids for brand, color, category and sub category"};if(void 0===a[s.categoryId])return{status:!1,message:"Invalid Category Id"};if(!a[s.categoryId].includes(s.subCatId))return{status:!1,message:"Invalid Sub Category Id"};if(!(s.color_id.length>0))return{status:!1,message:"Color id required"};console.log(r,s.color_id);for(let e of s.color_id)if(""!==e&&void 0===r[e])return{status:!1,message:"Invalid Color Id"};return{status:!0,message:"Everyhting is ok",vendorId:d}};e.exports={exportProductAddDemoSheet:async(e,t)=>{try{var s=new a.Workbook,r=s.addWorksheet("Add Bulk Product");let n=[{header:"Product Name",key:"product_name"},{header:"SKU CODE",key:"skucode"},{header:"HSN CODE",key:"hsncode"},{header:"Brand ID",key:"brand_id"},{header:"Category ID",key:"category_id"},{header:"Sub Category ID",key:"subcategory_id"},{header:"Color ID",key:"color_id"},{header:"Lot Size",key:"lotsize"},{header:"MRP",key:"mrp"},{header:"GST",key:"gst"},{header:"Seller Price",key:"seller_price"},{header:"In Hand QTY",key:"in_hand_qty"},{header:"Min Order QTY",key:"min_order_qty"},{header:"Sole",key:"sole"},{header:"Material",key:"material"},{header:"Packing Type",key:"packing_type"},{header:"Made In",key:"made_in"},{header:"Weight",key:"weight"},{header:"Description",key:"description"},{header:"Thumbnail URL",key:"thumbnail_url"},{header:"Multiple Images",key:"multiple_images"}];var d={product_name:"Demo prouduct name",skucode:"---",hsncode:"---",brand_id:"64b53---demo---id---747b",category_id:"64b53---demo---id---747b",subcategory_id:"64b53---demo---id---747b",color_id:"64b53---demo---id---747b",lotsize:"put multiple lot size seperat by ',' comma",mrp:"100",gst:"12",seller_price:"00",in_hand_qty:"00",min_order_qty:"0",sole:"--",material:"--",packing_type:"--",made_in:"India",weight:"0",description:"This is demo Description",thumbnail_url:"put url here",multiple_images:"put multiple url seperated by ',' comma"};if("ADMIN"===e.userModel){n.unshift({header:"Vendor ID",key:"vendor_id"});const e=[...n.slice(0,12),{header:"Margin",key:"margin"},{header:"Selling GST",key:"sellingGST"},...n.slice(12)];n=e,d.vendor_id="64b53---demo---id---747b",d.margin=0,d.sellingGST=0}return r.columns=n,r.addRow(d),r.getRow(1).eachCell((e=>{e.font={bold:!0},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"F08080"}}})),t.setHeader("Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),t.setHeader("Content-Disposition","attachment; brandid.xlsx"),s.xlsx.write(t).then((()=>{t.status(200)}))}catch(e){return t.status(500).send({status:!1,message:e.message})}},exportIDs:async(e,t)=>{try{var s=new a.Workbook,r=s.addWorksheet("Brand"),d=s.addWorksheet("Category & SubCategory & Colors");let u=await o.find().populate("sub_category"),l=await i.find();d.columns=[{header:"Category ID",key:"category_id"},{header:"Category Name",key:"category_name"},{header:"SubCategory ID",key:"subcategory_id"},{header:"SubCategory Name",key:"subcategory_name"}];for(let e of u)Object.keys(e.sub_category).forEach((t=>{d.addRow({category_id:e._id.toString(),category_name:e.category_name,subcategory_id:e.sub_category[t]._id.toString(),subcategory_name:e.sub_category[t].subcategory_name})}));if("ADMIN"===e.userModel){let e=await n.find({isActive:"Active",status:"Approved"}).populate("brand_id");r.columns=[{header:"Vendor ID",key:"vendor_unique_id"},{header:"Firm Name",key:"firmName"},{header:"Brand ID",key:"brand_id"},{header:"Brand Name",key:"brand_name"}];for(let t of e)Object.keys(t.brand_id).forEach((function(e){t.marginInPercentage>0&&r.addRow({vendor_unique_id:t.vendor_unique_id.toString(),firmName:t.firmName,brand_id:t.brand_id[e]._id.toString(),brand_name:t.brand_id[e].brand_name})}))}else{let t=await n.findById({_id:e.userId,isActive:"Active",status:"Approved"}).populate("brand_id");r.columns=[{header:"Brand ID",key:"brand_id"},{header:"Brand Name",key:"brand_name"}],Object.keys(t.brand_id).forEach((function(e){r.addRow({brand_id:t.brand_id[e]._id.toString(),brand_name:t.brand_id[e].brand_name})}))}r.getRow(1).eachCell((e=>{e.font={bold:!0},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"F08080"}}})),d.getRow(1).eachCell((e=>{e.font={bold:!0},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"9E99F7"}}})),d.addRow(),d.addRow({category_id:"Color ID",category_name:"Color Name"}),d.lastRow.eachCell((e=>{e.font={bold:!0},e.pattern="solid",e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"F08080"}}}));for(let e of l)d.addRow({category_id:e._id.toString(),category_name:e.colorName});return r.columns.forEach((e=>{const t=e.values.map((e=>e.toString().length)),s=Math.max(...t.filter((e=>"number"==typeof e)));e.width=s+3})),d.columns.forEach((e=>{const t=e.values.map((e=>e.toString().length)),s=Math.max(...t.filter((e=>"number"==typeof e)));e.width=s+3})),t.setHeader("Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),t.setHeader("Content-Disposition","attachment; brandid.xlsx"),s.xlsx.write(t).then((()=>{t.status(200)}))}catch(e){return t.status(500).send({status:!1,message:e.message})}},csvToJson:async(e,t)=>{try{vendorIds={},categoryIds={},colorIds={};let s=await u(e.files.csv),a=[];await r().fromStream(d.get(s)).subscribe((e=>{""!==e["Product Name"]&&a.push(e)}));let o={vendor_id:"",product_name:"",sku_code:"",hsn_code:"",brandId:"",color_id:"",categoryId:"",subCatId:"",lotSizeQty:"",mrp:"",gst:"",seller_price:"",qty_in_hand:"",min_order_qty:"",sole:"",material:"",packing_type:"",made_in:"",weight:"",description:""},i=[],c=[];for(let s of a){void 0!==s["Vendor ID"]&&(o.vendor_id=s["Vendor ID"]),void 0!==s["Product Name"]&&(o.product_name=s["Product Name"]),void 0!==s["SKU CODE"]&&(o.sku_code=s["SKU CODE"]),void 0!==s["HSN CODE"]&&(o.hsn_code=s["HSN CODE"]),void 0!==s["Brand ID"]&&(o.brandId=s["Brand ID"]),void 0!==s["Category ID"]&&(o.categoryId=s["Category ID"]),void 0!==s["Sub Category ID"]&&(o.subCatId=s["Sub Category ID"]),void 0!==s["Color ID"]&&(o.color_id=s["Color ID"].split(",").flatMap((e=>""!==e&&" "!==e?e.trim():[]))),void 0!==s["Lot Size"]&&(o.lotSizeQty=s["Lot Size"].split(",").flatMap((e=>""!==e&&" "!==e?e.trim():[]))),void 0!==s.MRP&&(o.mrp=Number(s.MRP)),void 0!==s.GST&&(o.gst=Number(s.GST)),void 0!==s["Seller Price"]&&(o.seller_price=Number(s["Seller Price"])),void 0!==s.Margin&&(o.margin=Number(s.Margin)),void 0!==s["Selling GST"]&&(o.sellingGST=Number(s["Selling GST"])),void 0!==s["In Hand QTY"]&&(o.qty_in_hand=Number(s["In Hand QTY"])),void 0!==s["Min Order QTY"]&&(o.min_order_qty=Number(s["Min Order QTY"])),void 0!==s.Sole&&(o.sole=s.Sole),void 0!==s.Material&&(o.material=s.Material),void 0!==s["Packing Type"]&&(o.packing_type=s["Packing Type"]),void 0!==s["Made In"]&&(o.made_in=s["Made In"]),void 0!==s.Weight&&(o.weight=s.Weight),void 0!==s.Description&&(o.description=s.Description),void 0!==s["Thumbnail URL"]&&(o.thumbnail_pic=s["Thumbnail URL"]),void 0!==s["Multiple Images"]&&(o.multiple_pics=s["Multiple Images"].split(",").map((e=>e.trim()))),"VENDOR"===e.userModel&&(o.vendor_id=e.userId);let a=await p(e,0,o);if(!a.status)return t.status(400).send({status:!1,message:a.message});"ADMIN"===e.userModel&&(-1===c.indexOf(a.vendorId)&&c.push(a.vendorId),o.vendor_id=a.vendorId,o.status="Approved"),i.push(o),o={vendor_id:"",product_name:"",sku_code:"",hsn_code:"",brandId:"",color_id:"",categoryId:"",subCatId:"",lotSizeQty:"",mrp:"",gst:"",seller_price:"",qty_in_hand:"",min_order_qty:"",sole:"",material:"",packing_type:"",made_in:"",weight:"",description:"",thumbnail_pic:"",multiple_pics:[]},"ADMIN"===e.userModel&&(o.margin="",o.sellingGST="")}if("ADMIN"===e.userModel){let e=await l.insertMany(i),t=[];for(let e of c){let s=await n.findById(e);t.push(s)}for(let s of e){let e=t.find((e=>e._id.toString()===s.vendor_id.toString()));e&&e.products.push(s)}for(let e of t)await e.save()}else{let t=await n.findById(e.userId),s=await l.insertMany(i);t.products.push(...s),await t.save()}return t.status(200).send({status:!0,message:"Bulk Product Added Successfully",data:{categoryIds,colorIds,vendorIds}})}catch(e){return t.status(500).send({status:!1,message:e.message})}},exportOrderReport:async(e,t)=>{try{let d=e.body,n=await c.find({_id:{$in:d}}).populate(["vendorId","payment_id","order_status_id","ordered_products","purchaseInvoice","saleInvoice",{path:"CouponCode",strictPopulate:!1},{path:"customer_id",model:"Customer",strictPopulate:!1,populate:{path:"defaultAddress",model:"CustomerAddress",strictPopulate:!1}}]),o=[],i={},u=0;for(let e of n){if(i.orderId=e.orderId,i.orderDate=m(e.order_date),i.invoiceNo=e.saleInvoice?e.saleInvoice.invoiceNo:"",i.invoiceDate=e.saleInvoice?m(e.saleInvoice.invoiceDate):"",i.productsLength=e.ordered_products?e.ordered_products.products.length:"",e.ordered_products&&e.ordered_products.products.length>u&&(u=e.ordered_products.products.length),e.ordered_products)for(let t=0;t<e.ordered_products.products.length;t++)i[`sale_sku_code_${t+1}`]=e.ordered_products.products[t].skuCode,i[`purchase_sku_code_${t+1}`]=e.ordered_products.products[t].skuCode,i[`sale_lotSize_${t+1}`]=e.ordered_products.products[t].lotSize,i[`purchase_lotSize_${t+1}`]=e.ordered_products.products[t].lotSize,i[`sale_gst_percentage_${t+1}`]=e.ordered_products.products[t].selling_gst,i[`purchase_gst_percentage_${t+1}`]=e.ordered_products.products[t].seller_gst;i.soldByGst=e.saleInvoice?e.saleInvoice.soldBy.gst:"",i.customerName=e.customer_id.name,i.customerPhone=e.customer_id.phone,i.customerAddress=e.customer_id.defaultAddress.address,i.customerCity=e.customer_id.defaultAddress.city,i.customerState=e.customer_id.defaultAddress.state,i.customerPincode=e.customer_id.defaultAddress.pincode,i.customerGstNo=e.customer_id.gstNo,i.customerAltPhone=e.customer_id.alternate_phone,i.saleGrandTotal=e.grand_total,i.saleInvGrandTotal=e.grand_total,i.saleDiscount=e.discounted_amount,i.saleNetTotal=Number(e.grand_total)-Number(e.discounted_amount),i.saleTaxableAmt=e.total,i.saleGstType=e.saleInvoice?e.saleInvoice.gstType:"",i.saleGstAmt=e.GST_amount,i.sellerName=e.vendorId.representativeName,i.sellerPhone=e.vendorId.mobileNo,i.sellerAddress=e.vendorId.pickupAddress,i.sellerCity=e.vendorId.pickupCity,i.sellerState=e.vendorId.pickupState,i.sellerPincode=e.vendorId.pickupPincode,i.sellerGstNo=e.vendorId.gstNo,i.sellerAltNo=e.vendorId.altMobileNo,i.purchaseGrandTotal=e.vendorAmtInfo.grandTotal,i.purchaseInvGrandTotal=e.vendorAmtInfo.grandTotal,i.purchaseNetTotal=e.vendorAmtInfo.grandTotal,i.purchaseTaxableAmt=e.vendorAmtInfo.total,i.purchaseGstType=e.purchaseInvoice?e.purchaseInvoice.gstType:"",i.purchaseGstAmt=e.vendorAmtInfo.gstAmt,i.orderJourneyFinalStatus=e.order_status_id.status;for(let t of e.order_status_id.statusList){let e="",s=m(t.updatedAt);t.updatedBy.admin&&(e="ADMIN"),t.updatedBy.vendor&&(e="SELLER"),i[t.status]=`${s} | ${e}`}o.push(i),i={}}var s=new a.Workbook,r=s.addWorksheet("Order Report");let l=[{header:"Order ID",key:"orderId"},{header:"Order date and time",key:"orderDate"},{header:"Invoice No",key:"invoiceNo"},{header:"Invoice date",key:"invoiceDate"},{header:"Order Quantity",key:"productsLength"},{header:"factorEz GST",key:"soldByGst"},{header:"STATE",key:"orderStatus"}],p=[{header:"Buyer Name",key:"customerName"},{header:"Buyer Phone Number",key:"customerPhone"},{header:"Full Address",key:"customerAddress"},{header:"Buyer City",key:"customerCity"},{header:"Buyer State",key:"customerState"},{header:"Pincode",key:"customerPincode"},{header:"Gst No.",key:"customerGstNo"},{header:"alternative phone",key:"customerAltPhone"}],g=[{header:"Total Amount",key:"saleGrandTotal"},{header:"Discount",key:"saleDiscount"},{header:"Final amount/ sales",key:"saleNetTotal"},{header:"Invoice Value",key:"saleInvGrandTotal"},{header:"Taxable value",key:"saleTaxableAmt"},{header:"Gst Type",key:"saleGstType"},{header:"Gst amount",key:"saleGstAmt"}],y=[{header:"Seller name",key:"sellerName"},{header:"Seller phone Number",key:"sellerPhone"},{header:"Full Address",key:"sellerAddress"},{header:"Seller City",key:"sellerCity"},{header:"Seller State",key:"sellerState"},{header:"Pincode",key:"sellerPincode"},{header:"Gst No.",key:"sellerGstNo"},{header:"alternative phone",key:"sellerAltNo"}],_=[{header:"Total Amount",key:"purchaseGrandTotal"},{header:"Seller Discount",key:"purchaseDiscount"},{header:"Final amount/ purchase",key:"purchaseNetTotal"},{header:"invoice value",key:"purchaseInvGrandTotal"},{header:"Taxable value",key:"purchaseTaxableAmt"},{header:"Gst Type",key:"purchaseGstType"},{header:"Gst amount",key:"purchaseGstAmt"}],f=[{header:"Final Status",key:"orderJourneyFinalStatus"},{header:"Delivered",key:"DELIVERED"},{header:"Out For Delivery",key:"OUT_FOR_DELIVERY"},{header:"Return delivered to seller/warehouse",key:"RETURNED_RTO_DELIVERED"},{header:"Return",key:"RETURNED"},{header:"Pickup-done/In transit",key:"PICKUP_DONE"},{header:"Pickup-Aligned",key:"PICKUP_ALIGNED"},{header:"Ready to dispatch",key:"READY_TO_DISPATCH"},{header:"Confirmed/in-process",key:"CONFIRMED"},{header:"cancelled",key:"CANCELLED"},{header:"Remarks",key:"remarks"}];for(let e=0;e<u;e++){let t={header:`SKU code ${e+1}`,key:`sale_sku_code_${e+1}`},s={header:`SKU code ${e+1}`,key:`purchase_sku_code_${e+1}`},a={header:`GST percentage ${e+1}`,key:`sale_gst_percentage_${e+1}`},r={header:`GST percentage ${e+1}`,key:`purchase_gst_percentage_${e+1}`},d={header:`Lot Set/Size set ${e+1}`,key:`sale_lotSize_${e+1}`},n={header:`Lot Set/Size set ${e+1}`,key:`purchase_lotSize_${e+1}`};g.push(t,d,a),_.push(s,n,r)}let h=[...l,...p,...g,...y,..._,...f];r.columns=h;for(let e of o)r.addRow(e);let I=l.length,A=p.length+I,b=g.length+A,S=y.length+b,N=_.length+S;return f.length,r.getRow(1).height=20,r.getRow(1).eachCell(((e,t)=>{e.border={top:{style:"thin"},right:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"}},e.font={bold:!0},t<=I?e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"d7ff38"}}:t<=A?(e.font={color:{argb:"ffffff"}},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"2e397d"}}):t<=b?e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"cad1fa"}}:t<=S?(e.font={color:{argb:"ffffff"}},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"556b58"}}):t<=N?e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"07f027"}}:(e.font={color:{argb:"ffffff"}},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"288a70"}})})),t.setHeader("Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),t.setHeader("Content-Disposition","attachment; orderReport.xlsx"),s.xlsx.write(t).then((()=>{t.status(200)}))}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},6160:(e,t,s)=>{const a=s(5831);e.exports={addFeaturedProducts:async(e,t)=>{try{let{newArrival:s,featuredProduct:r,bestSelling:d}=e.body,n=await a.find();if(n.length>0)r&&(n[0].featuredProduct.includes(r)||n[0].featuredProduct.push(r)),s&&(n[0].newArrival.includes(s)||n[0].newArrival.push(s)),d&&(n[0].bestSelling.includes(d)||n[0].bestSelling.push(d)),await n[0].save();else{let e={};r&&(e.featuredProduct=r),s&&(e.newArrival=s),d&&(e.bestSelling=d),await a.create(e)}return t.status(200).send({status:!0,message:"Product Added to respective sections..."})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getFeaturedProduct:async(e,t)=>{try{let e=await a.find().populate([{path:"featuredProduct",model:"Product",populate:{path:"vendor_id",model:"Vendor"}},{path:"bestSelling",model:"Product",populate:{path:"vendor_id",model:"Vendor"}},{path:"newArrival",model:"Product",populate:{path:"vendor_id",model:"Vendor"}}]);return t.status(200).send({status:!0,message:"fetched...",data:e[0]?e[0]:null})}catch(e){return t.status(500).send({status:!1,message:e.message})}},removeFeaturedProduct:async(e,t)=>{try{let{key:s,id:r}=e.body,d=await a.find();if(!(d.length>0))return t.status(400).send({status:!1,message:"Bad request"});if("featuredProduct"===s){let e=d[0].featuredProduct.findIndex((e=>e._id.toString()===r));e>=0&&d[0].featuredProduct.splice(e,1)}if("bestSelling"===s){let e=d[0].bestSelling.findIndex((e=>e._id.toString()===r));e>=0&&d[0].bestSelling.splice(e,1)}if("newArrival"===s){let e=d[0].newArrival.findIndex((e=>e._id.toString()===r));e>=0&&d[0].newArrival.splice(e,1)}return await d[0].save(),t.status(200).send({status:!0,message:"Removed..."})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},74:e=>{e.exports={generateRandomID:function(e,t){let s=t||"";for(let t=0;t<e-5;t++)s+="0123456789"[Math.floor(10*Math.random())];return s+=Date.now().toString().slice(8),s},generateRandomAlphaNumericID:function(e){let t="";for(let s=0;s<e;s++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[Math.floor(62*Math.random())];return t}}},8913:(e,t,s)=>{s(6860);const{initializeApp:a}=s(4324),{getStorage:r,ref:d,getDownloadURL:n,uploadBytesResumable:o}=s(1668),i=s(9336);s(4588).suppress=!0;const u=s(6752),{awsS3Bucket:l,awsAccessKey:c,awsSecretKey:m,awsS3Region:p}=s(341);a(u.firebaseConfig);const g=r(),y=()=>{const e=new Date;return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()};i.config.update({accessKeyId:c,secretAccessKey:m,region:p}),e.exports={uploadImage:async e=>{const t=y(),s=d(g,"files/"+t.toString().replace(" ","_")+"_"+e.name.replace(" ","_")),a={contentType:e.mimetype},r=await o(s,e.data,a),i=await n(r.ref);return{message:"file uploaded to firebase storage",name:r.metadata.name,type:e.mimetype,imageURL:i}},uploadFile:async e=>new Promise((function(t,s){let a=new i.S3;const r=y();var d={Bucket:l,Key:"images/"+r.toString().replace(" ","_")+"_"+e.name.replace(" ","_"),Body:e.data,ContentType:e.mimetype};a.upload(d,(function(e,a){return e?s({error:e}):t(a.Location)}))}))}},7628:(e,t,s)=>{const a=s(6443),r=s(2545),d=s(6756),n=s(9939),o=s(7355),i=s(4935),u=s(2891),{generatePdf:l}=s(1293),{dateToLocalDateTime:c}=s(4394),{financialYear:m}=s(1458);e.exports={generatePurchaseInvoice:async e=>{try{let{vendor_id:t,order_id:s,gstAmount:a,totalAmount:i}=e,u=await r.findById(t),l=await d.find();if(0===l.length||!l[0].defaultGST)return{status:!1,err:"Default gst not found"};let c=await o.findOne({invoiceNoType:"PURCHASE"}),p=m();c||(c=await o.create({invoiceNo:1,invoiceYear:p,invoiceNoLength:6,invoiceNoType:"PURCHASE"})),Number(p)!==c.invoiceYear&&(c.invoiceNo=1,c.invoiceYear=p);let g="0000000000"+c.invoiceNo,y=`FPIN${c.invoiceYear}${g.substring(g.length-c.invoiceNoLength)}`;c.invoiceNo+=1;let _={invoiceNo:y,invoiceDate:new Date,vendor_id:t,order_id:s,gstAmount:a.toFixed(2),totalAmount:i.toFixed(2),invoiceType:"PURCHASE"};u.gstNo.substring(0,2)===l[0].defaultGST.gstNo.substring(0,2)?_.gstType="CGST_SGST":_.gstType="IGST",_.soldBy={name:u.firmName,address:u.invoiceAddress,phone:u.mobileNo,gst:u.gstNo},_.shippingAddress={name:l[0].business_name,address:l[0].defaultGST.pickupAddress,phone:l[0].contactNo,gst:l[0].defaultGST.gstNo},_.billingAddress={name:l[0].business_name,address:l[0].defaultGST.pickupAddress,phone:l[0].contactNo,gst:l[0].defaultGST.gstNo};let f=await n.create(_);return await c.save(),{status:!0,invoice:f}}catch(e){return{status:!1,err:e}}},generateSaleInvoice:async e=>{try{let{customer_id:t,order_id:s,gstAmount:r,totalAmount:i,address:u}=e,l=await a.findById(t),c=await d.find();if(0===c.length||!c[0].defaultGST)return{status:!1,err:"Default gst not found"};let p=await o.findOne({invoiceNoType:"SALE"}),g=m();p||(p=await o.create({invoiceNo:1,invoiceYear:g,invoiceNoLength:6,invoiceNoType:"SALE"})),Number(g)!==p.invoiceYear&&(p.invoiceNo=1,p.invoiceYear=g);let y="0000000000"+p.invoiceNo,_=`FSIN${p.invoiceYear}${y.substring(y.length-p.invoiceNoLength)}`;p.invoiceNo+=1;let f={invoiceNo:_,invoiceDate:new Date,customer_id:t,order_id:s,gstAmount:r.toFixed(2),totalAmount:i.toFixed(2),invoiceType:"SALE"};l.defaultAddress.stateCode===c[0].defaultGST.gstNo.substring(0,2)?f.gstType="CGST_SGST":f.gstType="IGST",f.soldBy={name:c[0].business_name,address:c[0].defaultGST.pickupAddress,phone:c[0].contactNo,gst:c[0].defaultGST.gstNo},f.shippingAddress={name:l.name,address:u.address,phone:l.phone,gst:l.gstNo},f.billingAddress={name:l.name,address:u.address,phone:l.phone,gst:l.gstNo};let h=await n.create(f);return await p.save(),{status:!0,invoice:h}}catch(e){return{status:!1,err:e}}},getAllSaleInvoice:async(e,t)=>{try{let s=e.userModel,a=null;return a="ADMIN"===s?await n.find({invoiceType:"SALE"}):await n.find({invoiceType:"PURCHASE"}),t.status(200).send({status:!0,message:"Invoice fetched successfully...",data:a})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getAllPurchaseInvoice:async(e,t)=>{try{let s=[];return"ADMIN"===e.userModel&&(s=await n.find({invoiceType:"PURCHASE"})),"VENDOR"===e.userModel&&(s=await n.find({invoiceType:"PURCHASE",vendor_id:e.userId})),t.status(200).send({status:!0,message:"Invoice fetched successfully...",data:s})}catch(e){return t.status(500).send({status:!1,message:e.message})}},downoadInvoiceByInvoiceNumber:async(e,t)=>{try{let s=e.params.invoicenumber,a=e.params.invoicetype,r=await n.findOne({invoiceNo:s}).populate("order_id");if(!r)return t.status(400).send({status:!1,message:"Bad request"});if("PURCHASE"===a&&!r.vendor_id)return t.status(400).send({status:!1,message:"Bad request"});let o=await u.findOne({order_id:r.order_id}).populate({path:"products.product_id",model:"Product"});if(!o)return t.status(400).send({status:!1,message:"Bad request"});let m=await d.find();if(0===m.length)return t.status(400).send({status:!1,message:"Bad request"});if("PURCHASE"===a){let e={logo:m[0].invoiceLogo,brandName:m[0].business_name,soldBy:r.soldBy.name,soldByAddress:r.soldBy.address,soldByPhone:r.soldBy.phone,soldByGst:r.soldBy.gst,invoiceNo:s,orderId:r.order_id.orderId,orderDate:c(r.order_id.order_date),invoiceDate:c(r.invoiceDate),billToName:r.billingAddress.name,billToAddress:r.billingAddress.address,billToPhone:r.billingAddress.phone,billToGST:r.billingAddress.gst,shipToName:r.shippingAddress.name,shipToAddress:r.shippingAddress.address,shipToPhone:r.shippingAddress.phone,shipToGST:r.shippingAddress.gst,tableRow:[],totalAmt:"₹"+r.totalAmount,totalCGSTAmt:"",totalSGSTAmt:"",totalIGSTAmt:"",taxableAmt:r.totalAmount,totalTaxAmt:r.gstAmount,grossTotalAmt:(Number(r.gstAmount)+Number(r.totalAmount)).toFixed(2),discountAmt:"0",netPayableAmount:(Number(r.gstAmount)+Number(r.totalAmount)).toFixed(2)};if(r.soldBy.gst.substring(0,2)===r.billingAddress.gst.substring(0,2)){e.totalCGSTAmt="₹"+(Number(r.gstAmount)/2).toFixed(2),e.totalSGSTAmt="₹"+(Number(r.gstAmount)/2).toFixed(2);let t=1;for(let s of o.products)if(!s.isRemoved){let a={sno:t,productName:"",color:"",sizeSet:"",hsnCode:"",qty:"",rate:"",total:"",cgstPercentage:"",cgstAmount:"",sgstPercentage:"",sgstAmount:"",igstPercentage:"",igstAmount:""};t+=1,a.productName=s.product_id.product_name,a.color=s.color.colorName,a.sizeSet=s.lotSize,a.hsnCode=s.hsnCode,a.qty=s.qty,a.rate=s.seller_price,a.total=(Number(s.seller_price)*Number(s.qty)).toFixed(2),a.cgstPercentage=Number(s.seller_gst)/2,a.cgstAmount=(Number(s.seller_price)*Number(s.qty)*Number(s.seller_gst)/100).toFixed(2),a.sgstPercentage=Number(s.seller_gst)/2,a.sgstAmount=(Number(s.seller_price)*Number(s.qty)*Number(s.seller_gst)/100).toFixed(2),a.igstPercentage="",a.igstAmount="",e.tableRow.push(a)}}else{e.totalIGSTAmt=r.gstAmount;let t=1;for(let s of o.products)if(!s.isRemoved){let a={sno:t,productName:"",color:"",sizeSet:"",hsnCode:"",qty:"",rate:"",total:"",cgstPercentage:"",cgstAmount:"",sgstPercentage:"",sgstAmount:"",igstPercentage:"",igstAmount:""};t+=1,a.productName=s.product_id.product_name,a.color=s.color.colorName,a.sizeSet=s.lotSize,a.hsnCode=s.hsnCode,a.qty=s.qty,a.rate=s.seller_price,a.total=(Number(s.seller_price)*Number(s.qty)).toFixed(2),a.cgstPercentage="",a.cgstAmount="",a.sgstPercentage="",a.sgstAmount="",a.igstPercentage=s.seller_gst,a.igstAmount="₹"+(Number(s.seller_price)*Number(s.qty)*Number(s.seller_gst)/100).toFixed(2),e.tableRow.push(a)}}let a=await l(e,"factorEz.com");return t.setHeader("Content-Type","application/pdf"),t.setHeader("Content-Disposition","attachment; invoice.pdf"),t.send(a)}{let e=await i.findOne({customerId:r.customer_id}),a={logo:m[0].invoiceLogo,brandName:m[0].business_name,soldBy:r.soldBy.name,soldByAddress:r.soldBy.address,soldByGst:r.soldBy.gst,soldByPhone:r.soldBy.phone,invoiceNo:s,orderId:r.order_id.orderId,orderDate:c(r.order_id.order_date),invoiceDate:c(r.invoiceDate),billToName:r.billingAddress.name,billToAddress:r.billingAddress.address,billToPhone:r.billingAddress.phone,billToGST:r.billingAddress.gst,shipToName:r.shippingAddress.name,shipToAddress:r.shippingAddress.address,shipToPhone:r.shippingAddress.phone,shipToGST:r.shippingAddress.gst,totalAmt:"₹"+r.totalAmount,tableRow:[],totalCGSTAmt:"",totalSGSTAmt:"",totalIGSTAmt:"",taxableAmt:r.totalAmount,totalTaxAmt:r.gstAmount,grossTotalAmt:(Number(r.gstAmount)+Number(r.totalAmount)).toFixed(2),discountAmt:"",netPayableAmount:""};if(r.billingAddress.gst)if(r.soldBy.gst.substring(0,2)===r.billingAddress.gst.substring(0,2)){a.totalCGSTAmt="₹"+(Number(r.gstAmount)/2).toFixed(2),a.totalSGSTAmt="₹"+(Number(r.gstAmount)/2).toFixed(2);let e=1;for(let t of o.products)if(!t.isRemoved){let s={sno:e,productName:"",color:"",sizeSet:"",hsnCode:"",qty:"",rate:"",total:"",cgstPercentage:"",cgstAmount:"",sgstPercentage:"",sgstAmount:"",igstPercentage:"",igstAmount:""};e+=1,s.productName=t.product_id.product_name,s.color=t.color.colorName,s.sizeSet=t.lotSize,s.hsnCode=t.hsnCode,s.qty=t.qty,s.rate=t.seller_price,s.total=(Number(t.seller_price)*Number(t.qty)).toFixed(2),s.cgstPercentage=Number(t.seller_gst)/2,s.cgstAmount=(Number(t.seller_price)*Number(t.qty)*Number(t.seller_gst)/100).toFixed(2),s.sgstPercentage=Number(t.seller_gst)/2,s.sgstAmount=(Number(t.seller_price)*Number(t.qty)*Number(t.seller_gst)/100).toFixed(2),s.igstPercentage="",s.igstAmount="",a.tableRow.push(s)}}else{a.totalIGSTAmt=r.gstAmount;let e=1;for(let t of o.products)if(!t.isRemoved){let s={sno:e,productName:"",color:"",sizeSet:"",hsnCode:"",qty:"",rate:"",total:"",cgstPercentage:"",cgstAmount:"",sgstPercentage:"",sgstAmount:"",igstPercentage:"",igstAmount:""};e+=1,s.productName=t.product_id.product_name,s.color=t.color.colorName,s.sizeSet=t.lotSize,s.hsnCode=t.hsnCode,s.qty=t.qty,s.rate=t.seller_price,s.total=(Number(t.seller_price)*Number(t.qty)).toFixed(2),s.cgstPercentage="",s.cgstAmount="",s.sgstPercentage="",s.sgstAmount="",s.igstPercentage=t.seller_gst,s.igstAmount="₹"+(Number(t.seller_price)*Number(t.qty)*Number(t.seller_gst)/100).toFixed(2),a.tableRow.push(s)}}else if(r.soldBy.gst.substring(0,2)===e.stateCode){a.totalCGSTAmt="₹"+(Number(r.gstAmount)/2).toFixed(2),a.totalSGSTAmt="₹"+(Number(r.gstAmount)/2).toFixed(2);let e=1;for(let t of o.products)if(!t.isRemoved){let s={sno:e,productName:"",color:"",sizeSet:"",hsnCode:"",qty:"",rate:"",total:"",cgstPercentage:"",cgstAmount:"",sgstPercentage:"",sgstAmount:"",igstPercentage:"",igstAmount:""};e+=1,s.productName=t.product_id.product_name,s.color=t.color.colorName,s.sizeSet=t.lotSize,s.hsnCode=t.hsnCode,s.qty=t.qty,s.rate=Number(t.seller_price)+Number(t.seller_price)*Number(t.margin)/100,s.total=(Number(s.rate)*Number(t.qty)).toFixed(2),s.cgstPercentage=Number(t.selling_gst)/2;let r=Number(t.seller_price)*Number(t.qty)+Number(t.seller_price)*Number(t.qty)*Number(t.margin)/100;s.cgstAmount=(r*Number(t.selling_gst)/100).toFixed(2),s.sgstPercentage=Number(t.selling_gst)/2,s.sgstAmount=(r*Number(t.selling_gst)/100).toFixed(2),s.igstPercentage="",s.igstAmount="",a.tableRow.push(s)}}else{a.totalIGSTAmt=r.gstAmount;let e=1;for(let t of o.products)if(!t.isRemoved){let s={sno:e,productName:"",color:"",sizeSet:"",hsnCode:"",qty:"",rate:"",total:"",cgstPercentage:"",cgstAmount:"",sgstPercentage:"",sgstAmount:"",igstPercentage:"",igstAmount:""};e+=1,s.productName=t.product_id.product_name,s.color=t.color.colorName,s.sizeSet=t.lotSize,s.hsnCode=t.hsnCode,s.qty=t.qty,s.rate=t.seller_price,s.total=(Number(t.seller_price)*Number(t.qty)).toFixed(2),s.cgstPercentage="",s.cgstAmount="",s.sgstPercentage="",s.sgstAmount="",s.igstPercentage=t.seller_gst,s.igstAmount="₹"+(Number(t.seller_price)*Number(t.qty)*Number(t.seller_gst)/100).toFixed(2),a.tableRow.push(s)}}r.order_id.discounted_amount?(a.discountAmt="₹"+r.order_id.discounted_amount,a.netPayableAmount=Number(r.gstAmount)+Number(r.totalAmount)-Number(r.order_id.discounted_amount)):(a.discountAmt=0,a.netPayableAmount=a.grossTotalAmt);let d=await l(a,"factorEz.com");return t.setHeader("Content-Type","application/pdf"),t.setHeader("Content-Disposition","attachment; invoice.pdf"),t.send(d)}}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},4154:(e,t,s)=>{const a=s(272),r=s(6443),d=s(4935),n=(s(2545),s(1277)),o=(s(9074),s(8462)),{generateRandomID:i,generateRandomAlphaNumericID:u}=(s(2930),s(74)),l=s(2891),c=s(8536),{isValidObjectId:m}=s(1185),p=s(6632),{createPayment:g}=s(9472),{generatePurchaseInvoice:y,generateSaleInvoice:_}=s(7628),{isExpiryCoupon:f}=s(4289);e.exports={createOrder:async(e,t)=>{try{let s=e.params.customerId,o=e.body,{address_id:u,payment_mode:y,couponCode:_,paymentAmt:h,transaction_id:I}=o;if(!m(s))return t.status(400).send({status:!1,message:"Invalid Customer id request"});if(!m(u))return t.status(400).send({status:!1,message:"Invalid Address id request"});if(!y)return t.status(400).send({status:!1,message:"Bad request"});if("CUSTOM"!==y&&"TWENTY_ADV"!==y&&"PREPAID"!==y&&"COD"!==y)return t.status(400).send({status:!1,message:"Bad request"});if(("CUSTOM"===y||"TWENTY_ADV"===y||"PREPAID"===y)&&!I)return t.status(400).send({status:!1,message:"Bad request"});let A=await r.findById(s),b=await d.findById(u);if(!A||!b)return t.status(400).send({status:!1,message:"Bad request"});let S=await n.findOne({customer_id:s}).populate({path:"products.product_id",model:"Product"}),N={},D=null;if(_){if(D=await p.findOne({couponCode:_,isDeleted:!1,isExpired:!1}),!D)return t.status(400).send({status:!1,message:"Invalid Coupon Code"});if(D&&f(D.validTill))return D.isExpired=!0,await D.save(),t.status(400).send({status:!1,message:"Coupon Code Expired"});if(D.customer_id.includes(s))return t.status(200).send({status:!1,message:"Coupon Already applied"})}if(!S)return t.status(400).send({status:!1,message:"Bad Request"});let v=0;for(let e of S.products){let t=e.product_id.seller_price+e.product_id.margin*e.product_id.seller_price/100,s=t+t*e.product_id.sellingGST/100;v+=e.qty*s;let a=e.product_id.vendor_id.toString();a in N?N[a].push(e):N[a]=[e]}if(D&&D.minOrderAmt>v)return t.status(200).send({status:!1,message:`Coupon not applied, minimum order should be ${D.minOrderAmt}`});let w=[],E=0;for(let e of Object.keys(N)){let t=null,r={grandTotal:0,gstAmt:0,total:0},d=0,n=0;for(let s of N[e]){let a={product_id:"",vendor_id:"",mrp:"",seller_price:"",seller_gst:"",selling_price:"",selling_gst:"",margin:"",lotSize:"",color:{colorName:"",colorHex:""},hsnCode:"",skuCode:"",qty:"",addedAt:""};a.product_id=s.product_id._id,a.vendor_id=e,a.mrp=s.product_id.mrp,a.seller_price=s.product_id.seller_price,a.seller_gst=s.product_id.gst;let o=Number(s.product_id.seller_price)*Number(s.product_id.margin)/100,i=(Number(s.product_id.seller_price)+o)*Number(s.product_id.sellingGST)/100;a.selling_price=(Number(s.product_id.seller_price)+o+i).toFixed(2),a.selling_gst=s.product_id.sellingGST,a.lotSize=s.lotSize,a.color={colorName:s.color.colorName,colorHex:s.color.colorHex},a.hsnCode=s.product_id.hsn_code,a.skuCode=s.product_id.sku_code,a.margin=s.product_id.margin,a.qty=s.qty,a.lotSize=s.lotSize,a.addedAt=s.addedAt;let u=(Number(s.product_id.seller_price)+o)*Number(s.qty);d+=Number(u),n+=i*Number(s.qty);let c=Number(s.product_id.seller_price)*Number(s.qty),m=c*Number(s.product_id.gst)/100;r.grandTotal+=c+m,r.gstAmt+=m,r.total+=c,null===t?t=await l.create({products:[a]}):t.products.push(a)}await t.save();let o={orderId:i(10,"FZ"),vendorId:e,order_date:new Date,ordered_products:t,customer_id:s,address_id:u,GST_amount:n.toFixed(2),total:d.toFixed(2),grand_total:(Number(n)+Number(d)).toFixed(2),vendorAmtInfo:r};null!==D&&(o.couponCode=D._id),E+=Number(d)+Number(n);let m=await a.create(o),p=await c.create({order_id:m._id});m.order_status_id=p,await m.save(),t.order_id=m._id,await t.save(),w.push(m)}if(S.products=[],await S.save(),null!==D&&D.maxDiscPrice<E){let e=0;if("PERCENTAGE"===D.discountType){let t=Number(E)*Number(D.discountAmt)/100;e=t>D.maxDiscPrice?D.maxDiscPrice:t}else"PRICE"===D.discountType&&(e=D.discountAmt);if("PREPAID"===y&&Number(h)<Number(E)-Number(e))return t.status(400).send({status:!1,message:"payment should be equal to grand total amount"});for(let a of w){let r=Number((100*Number(a.grand_total)/Number(E)).toFixed(2)),d=Number((Number(e)*Number(r)/100).toFixed(2)),n=0;"CUSTOM"!==y&&"TWENTY_ADV"!==y||(n=Number((Number(h)*Number(r)/100).toFixed(2))),"PREPAID"===y&&(n=Number(a.grand_total)-Number(d)),a.discounted_amount=d;let o=await g(a.order_status_id.status,y,a.orderId,a._id,a.grand_total,d,n,s,I);if(!o.status)return t.status(400).send({status:!1,message:"Bad request"});a.payment_id=o.paymentId,a.shipping_address={stateCode:b.stateCode,state:b.state,address:b.address},await a.save(),A.orders.push(a._id)}D.customer_id.push(s),await D.save(),await A.save()}else{for(let e of w){let a=Number((100*Number(e.grand_total)/Number(E)).toFixed(2)),r=0,d=0;"CUSTOM"!==y&&"TWENTY_ADV"!==y||(d=Number((h*a/100).toFixed(2))),"PREPAID"===y&&(d=Number(e.grand_total)-Number(r));let n=await g(e.order_status_id.status,y,e.orderId,e._id,e.grand_total,r,d,s,I);if(!n.status)return t.status(400).send({status:!1,message:"Bad request"});e.payment_id=n.paymentId,e.shipping_address={stateCode:b.stateCode,state:b.state,address:b.address},await e.save(),A.orders.push(e._id)}await A.save()}return t.status(200).send({status:!0,message:"Order Created Successfully",data:"orders"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getAllOrders:async(e,t)=>{try{let s=null;return s="VENDOR"===e.userModel?await a.find({vendorId:e.userId}).populate(["vendorId","order_status_id","ordered_products","purchaseInvoice"]).select(["-shipping_address","-couponCode","-customer_id"]).sort({createdAt:-1}):await a.find().populate(["vendorId","payment_id","order_status_id","ordered_products","purchaseInvoice","saleInvoice",{path:"CouponCode",strictPopulate:!1},{path:"customer_id",model:"Customer",populate:{path:"defaultAddress",model:"CustomerAddress"}}]).sort({createdAt:-1}),t.status(200).send({status:!0,data:s})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getOrderByOrderId:async(e,t)=>{try{let s=e.params.orderId,r=e.params.customerId;if(!m(r))return t.status(400).send({status:!1,message:"Invalid Customer id"});let d=await a.findOne({customer_id:r,orderId:s}).populate(["payment_id","order_status_id",{path:"ordered_products",model:"Ordered_Product",populate:{path:"products.product_id",model:"Product"}},"saleInvoice",{path:"CouponCode",strictPopulate:!1}]).select("-purchaseInvoice");return d?t.status(200).send({status:!0,data:d}):t.status(404).send({status:!1,message:"Order not found"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getOrdersByCustomerId:async(e,t)=>{try{let s=e.params.customerId,r=await a.find({customer_id:s}).populate(["vendorId","customer_id","payment_id","order_status_id","ordered_products"]);return t.status(200).send({status:!0,data:r})}catch(e){return t.status(500).send({status:!1,message:e.message})}},cancelOrderByOrderId:async(e,t)=>{try{let s=e.params.orderId;if(!m(s))return t.status(400).send({status:!1,message:"Invalid Order Id"});let r=await a.findOne({_id:s});if(!r)return t.status(404).send({status:!1,message:"Order not found with this order id"});let d=e.body,{Status:n}=d;return"Cancelled"===r.Status?t.status(400).send({status:!1,message:"Order is already cancelled"}):(await a.findOneAndUpdate({_id:s},{$set:{Status:"Cancelled"}},{new:!0}),await r.save(),t.status(202).send({status:!0,message:"Order Cancelled Successfully"}))}catch(e){return t.status(500).send({status:!1,message:e.message})}},updateOrderByOrderId:async(e,t)=>{try{let s=e.params.orderId,{orderType:r,cancelMessage:d,questionId:n,removedProductIds:i}=e.body;if(!r||!s)return t.status(400).send({status:!1,message:"Bad request"});let u=await a.findOne({orderId:s}).populate(["ordered_products","order_status_id"]);if(!u)return t.status(400).send({status:!1,message:"Bad request"});if("PENDING"!==u.order_status_id.status&&"VENDOR"===e.userModel)return t.status(400).send({status:!1,message:"Bad request"});let l=await o.findById(u.payment_id._id);if(!l)return t.status(400).send({status:!1,message:"Bad request"});if("PARTIAL_CONFIRMED"===r){let t=u.ordered_products,s=0,a=0,n={productQty:0,total:0,GST_amount:0,grand_total:0},o={grand_total:0,total:0,GST_amount:0,discounted_amount:0};for(let e of t.products)if(!1===e.isRemoved&&i.includes(e._id.toString())){e.isRemoved=!0;let t=Number(e.seller_price)*Number(e.qty);s+=t,a+=Number((t*Number(e.seller_gst)/100).toFixed(2));let r=t+t*e.margin/100;n.productQty+=1,n.total+=Number(r.toFixed(2)),n.GST_amount+=Number((r*e.selling_gst/100).toFixed(2)),n.grand_total+=r+Number((r*e.selling_gst/100).toFixed(2))}u.order_status_id.status=r,l.order_status="PARTIAL_CONFIRMED";let c={};"VENDOR"===e.userModel?c.vendor=e.userId:"ADMIN"===e.userModel&&(c.admin=e.userId);let m={status:r,updatedBy:c,updatedAt:new Date,description:d};u.order_status_id.statusList.push(m),u.vendorAmtInfo.gstAmt-=a,u.vendorAmtInfo.total-=s,u.vendorAmtInfo.grandTotal-=a+s,o.GST_amount=u.GST_amount,o.total=u.total,o.grand_total=u.grand_total,u.GST_amount-=n.GST_amount,u.total-=n.total,u.grand_total-=n.grand_total,u.partialCancelOrderInfo={orderedAmtInfo:o,orderedProductAmtInfo:n},await t.save(),await u.order_status_id.save();let p=0,g=0;for(let e of u.ordered_products.products)p+=e.seller_price*e.qty*e.seller_gst/100,g+=e.seller_price*e.qty;let f={vendor_id:u.vendorId,order_id:u._id,gstAmount:p,totalAmount:g},h={customer_id:u.customer_id,order_id:u._id,gstAmount:u.GST_amount,totalAmount:u.total,address:u.shipping_address};if(("CUSTOM"===l.payment_mode||"TWENTY_ADV"===l.payment_mode)&&l.partial_payment.payment_amount>=Number(u.grand_total)-Number(u.discounted_amount))l.return_amount=(Number(l.partial_payment.payment_amount)-(Number(u.grand_total)-Number(u.discounted_amount))).toFixed(2),l.balance_amount=0;else if(("CUSTOM"===l.payment_mode||"TWENTY_ADV"===l.payment_mode)&&l.partial_payment.payment_amount<u.grand_total){l.return_amount=0;let e=Number(u.grand_total)-Number(u.discounted_amount);l.balance_amount=e-Number(l.partial_payment.payment_amount).toFixed(2)}else"PREPAID"===l.payment_mode&&l.payment_amount>=Number(u.grand_total)-Number(u.discounted_amount)?(l.return_amount=(Number(l.payment_amount)-(Number(u.grand_total)-Number(u.discounted_amount))).toFixed(2),l.balance_amount=0):"COD"===l.payment_mode&&(l.return_amount=0,l.balance_amount=Number(u.grand_total)-Number(u.discounted_amount));l.order_amount=u.grand_total;let I=await y(f),A=await _(h);I.status&&(u.purchaseInvoice=I.invoice._id),A.status&&(u.saleInvoice=A.invoice._id)}if("CANCEL"===r){u.order_status_id.status="CANCELLED",l.order_status="CANCELLED";let t={};"VENDOR"===e.userModel?t.vendor=e.userId:"ADMIN"===e.userModel?t.admin=e.userId:t.customer=e.userId,u.order_status_id.cancelled.userId=t,u.order_status_id.cancelled.question=n,u.order_status_id.cancelled.description=d,u.order_status_id.cancelledStatus="CANCELLED";let s={status:"CANCELLED",updatedBy:t,updatedAt:new Date};u.order_status_id.cancelledStatusList.push(s),"CUSTOM"===l.payment_mode||"PREPAID"===l.payment_mode||"TWENTY_ADV"===l.payment_mode?"CUSTOM"===l.payment_mode?(l.return_amount=Number(l.partial_payment.payment_amount)+Number(l.cod_received),l.balance_amount=0):"PREPAID"===l.payment_mode?(l.return_amount=l.payment_amount,l.balance_amount=0):"TWENTY_ADV"===l.payment_mode&&(l.return_amount=l.partial_payment.payment_amount+Number(l.cod_received),l.balance_amount=0):"COD"===l.payment_mode&&(l.return_amount=Number(l.cod_received),l.balance_amount=0),await u.order_status_id.save()}if("CONFIRMED"===r){u.order_status_id.status=r,l.order_status="CONFIRMED";let s={};"VENDOR"===e.userModel?s.vendor=e.userId:"ADMIN"===e.userModel&&(s.admin=e.userId);let a={status:r,updatedBy:s,updatedAt:new Date};u.order_status_id.statusList.push(a),await u.order_status_id.save();let d=0,n=0;for(let e of u.ordered_products.products)d+=e.seller_price*e.qty*e.seller_gst/100,n+=e.seller_price*e.qty;let o={vendor_id:u.vendorId,order_id:u._id,gstAmount:d,totalAmount:n},i={customer_id:u.customer_id,order_id:u._id,gstAmount:u.GST_amount,totalAmount:u.total,address:u.shipping_address},c=await y(o),m=await _(i);if(!c.status)return t.status(400).send({status:!1,message:c.err});if(u.purchaseInvoice=c.invoice._id,!m.status)return t.status(400).send({status:!1,message:m.err});u.saleInvoice=m.invoice._id}return await l.save(),await u.save(),t.status(202).send({status:!0,message:"Order updated successfully",data:u})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getOrderedProduct:async(e,t)=>{try{let s=e.params.orderedproductid,a=await l.findById(s).populate("products.product_id");return t.status(200).send({status:!0,message:"details fetched successfully...",data:a})}catch(e){return t.status(500).send({status:!1,message:e.message})}},patchTrackingIdByOrderId:async(e,t)=>{try{let s=e.params.orderId,{t_id:r}=e.body;if(!s||!r)return t.status(400).send({status:!1,message:"Bad request"});let d=await a.findOne({orderId:s}).populate("order_status_id");return d?"PENDING"===d.order_status_id.status?t.status(400).send({status:!1,message:"Bad request"}):(d.tracking_id=r,await d.save(),t.status(200).send({status:!0,message:"Tracking ID Updated successfully..."})):t.status(400).send({status:!1,message:"Bad request"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getAllCancelledOrder:async(e,t)=>{try{let s=e.userModel,r=(e.userId,null);if(r="VENDOR"===s?await a.find({vendorId:e.userId}).populate(["vendorId","order_status_id","ordered_products"]).select(["-shipping_address","-couponCode","-customer_id"]).sort({createdAt:-1}):await a.find().populate(["vendorId","customer_id","payment_id","order_status_id","ordered_products"]).sort({createdAt:-1}),!r)return t.status(400).send({status:!1,message:"Bad request"});let d=[];for(let e of r)"CANCELLED"===e.order_status_id.status&&d.push(e);return t.status(200).send({status:!0,message:"Cancelled orders fetched...",data:d})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},9352:(e,t,s)=>{const a=s(8536),r=s(272),d=s(2930),{isValidObjectId:n}=s(1185);e.exports={createOrderStatusTable:async(e,t)=>{try{let s=e.params.orderId;if(!n(s))return t.status(400).send({status:!1,message:"Invalid Order Id"});let o=await r.findOne({_id:s});if(!o)return t.status(404).send({status:!1,message:"Order not found with this order id"});let i=e.body,{questions:u,customerAnswer:l}=i;await r.findOneAndUpdate({_id:s},{$set:{Status:"Cancelled"}},{new:!0}),await o.save();let c={questions:u,customerAnswer:l},m=await d.create(c),p={cancelledBy:e.body.cancelledBy,userId:e.body.userId,reason:m._id},g=await a.create({order_id:o._id,status:"Cancelled",isCompleted:!1,cancelled:p});return t.status(201).send({status:!0,message:"Success",data:{OrderStatusTableData:g,cancelledReasonData:m}})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getAllOrderStatusTables:async(e,t)=>{try{let e=await a.find();return t.status(200).send({status:!0,data:e})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getOrderStatusTableById:async(e,t)=>{try{let s=e.params.orderStatusTableId;if(!n(s))return t.status(400).send({status:!1,message:"Invalid order status table id"});let r=await a.findOne({_id:s});return r?t.status(200).send({status:!0,data:r}):t.status(404).send({status:!1,message:"Order Status Table not found"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},updateOrderStatusByOrderId:async(e,t)=>{try{let s=e.params.orderId,{status:r}=e.body;if(!n(s))return t.status(400).send({status:!1,message:"Invalid order id"});let d=await a.findOne({order_id:s});if(!d)return t.status(404).send({status:!1,message:"Order status table not found"});if(!r)return t.status(400).send({status:!1,message:"Bad request"});d.status=r;let o={};"VENDOR"===e.userModel?o.vendor=e.userId:"ADMIN"===e.userModel&&(o.admin=e.userId);let i={status:r,updatedBy:o,updatedAt:new Date};return d.statusList.push(i),await d.save(),t.status(202).send({status:!0,message:"Success",data:d})}catch(e){return t.status(500).send({status:!1,message:e.message})}},bulkOrderProcess:async(e,t)=>{try{let{status:s,orderIds:r}=e.body,d=await a.find({order_id:{$in:r}}),n={};"VENDOR"===e.userModel?n.vendor=e.userId:"ADMIN"===e.userModel&&(n.admin=e.userId);let o={status:s,updatedBy:n,updatedAt:new Date};for await(let e of d)"CANCELLED"!==e.status&&"PENDING"!==e.status&&(e.status=s,e.statusList.push(o),await e.save());return t.status(202).send({status:!0,message:"Orders Processed"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},cancelOrderReturnById:async(e,t)=>{try{let s=e.params.orderId,{status:r}=e.body;if(!n(s))return t.status(400).send({status:!1,message:"Invalid order id"});let d=await a.findOne({order_id:s});if(!d)return t.status(404).send({status:!1,message:"Order status table not found"});if(!r)return t.status(400).send({status:!1,message:"Bad request"});d.cancelledStatus=r;let o={};"VENDOR"===e.userModel?o.vendor=e.userId:"ADMIN"===e.userModel?o.admin=e.userId:o.customer=e.userId;let i={status:r,updatedBy:o,updatedAt:new Date};return d.cancelledStatusList.push(i),await d.save(),t.status(202).send({status:!0,message:"Return Status Updated"})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},3500:(e,t,s)=>{const a=s(9344),{twilioAccSID:r,twilioAuthToken:d,twilioVerifySID:n,tokenSecretKey:o,customerTokenSecretKey:i}=s(341),u=s(6443),l=s(7096),c=r,m=d,p=n,g=s(7202)(c,m);e.exports={sendOTP:async(e,t)=>{try{let s=e.params.phone;if(!s)return t.status(400).send({status:!1,message:"phone number are required"});let a=!1;return await g.verify.v2.services(p).verifications.create({to:`+91${s}`,channel:"sms"}).then((e=>{a=!0})).catch((e=>{console.log(e)})),a?t.status(200).send({status:!0,message:"OTP send successfully"}):t.status(400).send({status:!1,message:"Otp not send"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},verityOTP:async(e,t)=>{try{let s=e.params.phone,r=e.params.otpCode;if(!s||!r)return t.status(400).send({status:!1,message:"phone number and otp are required"});let d=!1;if(await g.verify.v2.services(p).verificationChecks.create({to:`+91${s}`,code:r}).then((e=>{"approved"!==e.status&&!0!==e.valid||(d=!0)})).catch((e=>{})),d){let e=await(async e=>{try{let t=await u.findOne({phone:e,isDeleted:!1});if(t||(t=await u.create({phone:e})),t.isBlocked)return{statusCode:403,status:!1,message:"This account has been blocked"};if(!t.isActivated)return{statusCode:200,status:!0,isActivated:!1,data:{customerId:t._id},message:"Account is not active, Please fill your information"};let s={name:t.name,email:t.email,userType:"CUSTOMER",customerId:t._id.toString(),phone:t.phone,isActivated:t.isActivated};t.profileUrl&&(s.photo=t.profileUrl),t.alternate_phone&&(s.altMobileNo=t.alternate_phone);let r=Date.now(),d=Math.floor(r/1e3),n=a.sign({userId:t._id.toString(),phone:t.phone,userModel:"CUSTOMER",iat:d},i,{expiresIn:"24h"});return s.token=n,{statusCode:200,status:!0,message:"Login successfully",data:s}}catch(e){return{statusCode:500,status:!1,message:"something went wrong"}}})(s);return 403===e.statusCode?t.status(403).send({status:!1,message:e.message}):200===e.statusCode&&e.isActivated?(t.setHeader("Authorization","Bearer "+e.data.token),t.status(200).send({status:!0,isActivated:!0,message:e.message,data:e.data})):200!==e.statusCode||e.isActivated?500===e.statusCode?t.status(500).send({status:!1,message:e.message}):t.status(400).send({status:!1,message:"Something went wrong..."}):t.status(200).send({status:!0,isActivated:!1,message:e.message,data:e.data})}return t.status(403).send({status:!1,message:"otp not verified"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},forgetPasswordUsingOtp:async(e,t)=>{try{let s=e.params.phone,a=e.params.otpCode,{password:r}=e.body;if(!s||!a||!r)return t.status(400).send({status:!1,message:"Phone number, password and otp are required"});let d=!1;if(await g.verify.v2.services(p).verificationChecks.create({to:`+91${s}`,code:a}).then((e=>{"approved"!==e.status&&!0!==e.valid||(d=!0)})).catch((e=>{})),d){let e=await(async(e,t)=>{try{let s=await u.findOne({phone:e,isDeleted:!1});if(s||(s=await u.create({phone:e})),s.isBlocked)return{statusCode:403,status:!1,message:"This account has been blocked"};if(!s.isActivated)return{statusCode:200,status:!0,isActivated:!1,data:{customerId:s._id},message:"Account is not active, Please fill your information"};let a=await l.hash(t,10);return s.password=a,await s.save(),{statusCode:200,status:!0,message:"Password updated successfully"}}catch(e){return{statusCode:500,status:!1,message:"something went wrong"}}})(s,r);return t.status(e.statusCode).send({status:e.status,message:e.message})}return t.status(403).send({status:!1,message:"OTP not verified"})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},9472:(e,t,s)=>{const a=s(8462),r=s(272),{generateRandomID:d}=(s(1277),s(4935),s(74));e.exports={createPayment:async(e,t,s,r,n,o,i,u,l)=>{try{if(!t||!u)return{status:!1};let c={order_status:e,paymentId:d(20),customer_id:u,payment_status:"",payment_mode:t,order_amount:n,discount_amt:o,balance_amount:0,order_id:{orderId:r,order_custom_id:s}};return"CUSTOM"===t||"TWENTY_ADV"===t?(c.partial_payment={payment_amount:i.toFixed(2),date:new Date,transactionId:l},c.payment_status="PARTIAL_PAID",n>i&&(c.balance_amount=(n-i-o).toFixed(2))):"PREPAID"===t?(c.transactionId=l,c.payment_amount=i.toFixed(2),c.payment_status="RECEIVED",c.payment_date=new Date,c.balance_amount=0):"COD"===t&&(c.payment_status="PENDING",c.balance_amount=(n-i-o).toFixed(2)),{status:!0,paymentId:(await a.create(c))._id}}catch(e){return{status:!1}}},updatePaymentStatus:async(e,t)=>{try{let s=e.params.paymentId,{payment_date:r,payment_amount:d,payment_status:n}=e.body;console.log(e.body);let o=await a.findById(s);if(!o)return t.status(404).send({status:!1,message:"Payment not found with this payment id"});if(!r||!d||!n)return t.status(400).send({status:!1,message:"All fields are required"});switch(o.payment_date=new Date(r),n){case"RECEIVED":if(Number(o.balance_amount)!==Number(d))return t.status(400).send({status:!1,message:"Received amount should be equal to balance amount"});o.payment_amount+=Number(d),o.cod_received=Number(d),o.payment_status=n,o.balance_amount=0;break;case"REFUNDED":if(Number(o.return_amount)!==Number(d))return t.status(400).send({status:!1,message:"Cancelled amount should be equal to refund amount"});"CANCELLED"===o.order_status?(o.payment_status="REFUNDED",o.return_amount=Number(d),o.balance_amount=0):"PARTIAL_CONFIRMED"===o.order_status?(o.payment_status="PARTIAL_REFUNDED",o.return_amount=Number(d),o.balance_amount=0):(o.payment_status="REFUNDED",o.return_amount=Number(d),o.balance_amount=0)}return await o.save(),t.status(202).send({status:!0,message:"Payment status updated successfully",data:o})}catch(e){return t.status(500).send({status:!1,message:e.message})}},addPayment:async(e,t)=>{try{let s=e.params.orderId,n=e.body,o=856.8,{payment_mode:i}=n,u=await r.findOne({_id:s});if(!u)return t.status(404).send({status:!1,message:"Order not found"});if(o>u.grand_total)return t.status(400).send({status:!1,message:"Paid amount can not be greater than the Grand Total"});let l={paymentId:d(10),order_id:u._id,customer_id:u.customer_id,payment_status:"Pending",payment_mode:i,transactionId:d(25),payment_amount:o,payment_date:(new Date).toLocaleString(),partial_mode:null};if("TEN_ADV"===i){let e=.1*u.grand_total,s={payment_mode:"TEN_ADV",amount:e,date:new Date,transactionId:d(25)},r=await partialPaymentModel.findOne({});if(r){let t={payment_mode:"TEN_ADV",amount:u.grand_total-e,date:new Date,transactionId:d(25)};r.paymentDetails.push(t),await r.save()}let n={paymentDetails:s,remaining_amount:u.grand_total-s.amount};newPartialPayment=await partialPaymentModel.create(n),l.partial_mode=newPartialPayment._id,l.payment_status="Pending",l.payment_amount=e,l.paymentDetails=[s];let o=await a.create(l);return t.status(200).send({status:!0,message:"Success",data:{partialPaymentData:newPartialPayment,paymentData:o}})}if("TWENTY_ADV"===i){let e=.2*u.grand_total,s={payment_mode:"TWENTY_ADV",amount:e,date:new Date,transactionId:d(25)},r=await partialPaymentModel.findOne({payment_mode:"TWENTY_ADV"});if(r){let t={payment_mode:"TWENTY_ADV",amount:u.grand_total-e,date:new Date,transactionId:d(25)};r.paymentDetails.push(t),await r.save()}let n={paymentDetails:s,remaining_amount:u.grand_total-s.amount};newPartialPayment=await partialPaymentModel.create(n),l.partial_mode=newPartialPayment._id,l.payment_status="PENDING",l.payment_amount=e,l.paymentDetails=[s];let o=await a.create(l);return t.status(200).send({status:!0,message:"Success",data:{partialPaymentData:newPartialPayment,paymentData:o}})}if("COD"===i){if(o<u.grand_total){let e={payment_mode:"COD",amount:o,date:new Date,transactionId:d(25)},s=await partialPaymentModel.findOne({payment_mode:"COD"});if(s)s.paymentDetails.push(e),s.remaining_amount=u.grand_total-o-s.paymentDetails.reduce(((e,t)=>e+t.amount),0),await s.save(),l.partial_mode=s._id;else{s=await partialPaymentModel.create({paymentDetails:[e],remaining_amount:u.grand_total-o,payment_mode:"COD"});const t=await s.save();l.partial_mode=t._id}newPartialPayment=await partialPaymentModel.create(s),l.partial_mode=newPartialPayment._id,l.payment_status="PENDING";let r=await a.create(l);return t.status(200).send({status:!0,message:"Success",data:{partialPaymentData:newPartialPayment,paymentData:r}})}{l.payment_status="RECEIVED";let e=await a.create(l);return t.status(200).send({status:!0,message:"Success",data:{paymentData:e}})}}if(o===u.grand_total){l.payment_status="RECEIVED";let e=await a.create(l);return t.status(200).send({status:!0,message:"Success",data:e})}return t.status(400).send({status:!1,message:"Paid amount should be equal to Grand Total"})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},3824:(e,t,s)=>{const{isValidObjectId:a}=s(1185),r=(s(8910),s(9074)),d=s(2545),n=s(6150),o=s(7227),i=s(2115),{isValid:u}=s(5484),{uploadFile:l}=s(8913),{calculateMarginAndSelling:c}=s(5784),m=async e=>await l(e);e.exports={addProduct:async(e,t)=>{try{let s=e.body,{product_name:a,sku_code:c,hsn_code:p,brandId:g,color:y,categoryId:_,subCatId:f,stockStatus:h,lotSizeQty:I,mrp:A,seller_price:b,gst:S,sellingGST:N,margin:D,qty_in_hand:v,min_order_qty:w,sole:E,material:C,packing_type:O,made_in:T,weight:R,description:P,meta:k,vendor_id:q}=s;if(!u(a))return t.status(400).send({status:!1,message:"Product name is required"});if(!u(c))return t.status(400).send({status:!1,message:"SKU code is required"});if(!u(p))return t.status(400).send({status:!1,message:"HSN code is required"});if(!u(A))return t.status(400).send({status:!1,message:"Product MRP is required"});if(!u(S))return t.status(400).send({status:!1,message:"GST is required"});if(!u(g))return t.status(400).send({status:!1,message:"Brand ID is required"});if(!u(b))return t.status(400).send({status:!1,message:"Seller price is required"});if(!u(_))return t.status(400).send({status:!1,message:"Category ID is required"});if(!u(f))return t.status(400).send({status:!1,message:"Sub category ID is required"});if(!u(h))return t.status(400).send({status:!1,message:"Stock status is required"});if(!u(I))return t.status(400).send({status:!1,message:"Lot size is required"});if(!u(v))return t.status(400).send({status:!1,message:"Quantity in hand is required"});if(!u(w))return t.status(400).send({status:!1,message:"Minimum order quantity is required"});if(!u(y))return t.status(400).send({status:!1,message:"Product color is required"});if("ADMIN"===e.userModel){if(!u(N))return t.status(400).send({status:!1,message:"Selling GST is required"});if(!u(D))return t.status(400).send({status:!1,message:"Margin is required"});if(!u(q))return t.status(400).send({status:!1,message:"Vendor id is required"})}void 0!==k&&(k=JSON.parse(k));let M={product_name:a,sku_code:c,brandId:g,gst:S,hsn_code:p,color_id:JSON.parse(y),categoryId:_,subCatId:f,stockStatus:h,lotSizeQty:JSON.parse(I),mrp:A,seller_price:b,qty_in_hand:v,min_order_qty:w,sole:E,material:C,packing_type:O,made_in:T,weight:R,description:P};"ADMIN"===e.userModel&&(M.sellingGST=N,M.margin=D,M.status="Approved"),void 0!==k&&(M.meta_title=k.metaTitle,M.meta_keywords=k.metaKeyword,M.meta_description=k.metaDescription),void 0!==e.body.vendorId?M.vendor_id=e.body.vendorId:M.vendor_id=e.userId;let B=[];if(e.files&&e.files.thumbnail?M.thumbnail_pic=await l(e.files.thumbnail):void 0!==s.thumbnail&&(M.thumbnail_pic=s.thumbnail),e.files&&e.files.mulImg){B=e.files.mulImg;let t=[];if(Array.isArray(B))for(let e of B){let s=await m(e);t.push(s)}else{let e=await m(B);t.push(e)}M.multiple_pics=t}else void 0!==s.mulImg&&(M.multiple_pics=s.mulImg);let x=await n.findById(g),U=await o.findById(_),L=await i.findById(f);if(!x||!U||!L)return t.status(400).send({status:!1,message:"Brand, aritcle, category or subcategory id had some error"});g=x,_=U,f=L;let V=await r.create(M),G=null;return"ADMIN"===e.userModel?(G=await d.findById(q),V.vendor_id=G._id):(G=await d.findById(e.userId),V.vendor_id=G._id),G.products.push(V),await G.save(),await V.save(),t.status(201).send({status:!0,message:"Success",data:V})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getAllProducts:async(e,t)=>{try{let s=[];if("VENDOR"===e.userModel)s=await r.find({isDeleted:!1,vendor_id:e.userId}).populate(["color_id","categoryId","subCatId","brandId"]);else{let e=await r.find({isDeleted:!1}).populate(["color_id","categoryId","subCatId","brandId","vendor_id"]);for(let t of e)"Approved"===t.vendor_id.status&&s.push(t)}return t.status(200).send({status:!0,data:s})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getProductById:async(e,t)=>{try{let s=e.params.productId,a=null;return a="VENDOR"===e.userModel?await r.findOne({_id:s,isDeleted:!1,vendor_id:e.userId}):await r.findOne({_id:s,isDeleted:!1}),t.status(200).send({status:!0,data:a})}catch(e){return t.status(500).send({status:!1,message:e.message})}},updateProductByProductId:async(e,t)=>{try{let s=e.params.productId;if(!a(s))return t.status(400).send({status:!1,message:"Invalid product id"});let d=await r.findOne({_id:s,isDeleted:!1});if(!d)return t.status(404).send({status:!1,message:"Product not found"});let n=e.body;return"product_name"in n&&(d.product_name=n.product_name),"sku_code"in n&&(d.sku_code=n.sku_code),"description"in n&&(d.description=n.description),"mrp"in n&&(d.mrp=n.mrp),"seller_price"in n&&(d.seller_price=n.seller_price),"selling_price"in n&&(d.selling_price=n.selling_price),"gst_amount"in n&&(d.gst_amount=n.gst_amount),"stock_status"in n&&(d.stockStatus=n.stock_status),"qty_in_hand"in n&&(d.qty_in_hand=n.qty_in_hand),"min_order_qty"in n&&(d.min_order_qty=n.min_order_qty),"size_qty"in n&&(d.size_qty=n.size_qty),"color"in n&&(d.color=n.color),"style"in n&&(d.style=n.style),"sole"in n&&(d.sole=n.sole),"material"in n&&(d.material=n.material),"packing_type"in n&&(d.packing_type=n.packing_type),"made_in"in n&&(d.made_in=n.made_in),"primary_category"in n&&(d.primary_category=n.primary_category),"weight"in n&&(d.weight=n.weight),"category"in n&&(d.categoryId=n.category),"meta_title"in n&&(d.meta_title=n.meta_title),"meta_description"in n&&(d.meta_description=n.meta_description),"status"in n&&(d.status=n.status),await d.save(),t.status(200).send({status:!0,message:"success",data:d})}catch(e){return t.status(500).send({status:!1,message:e.message})}},deleteProductByProductId:async(e,t)=>{try{let s=e.params.productId;return a?await r.findOne({_id:s,isDeleted:!1})?await r.findOneAndUpdate({_id:s,isDeleted:!1},{isDeleted:!0,deletedAt:new Date},{new:!0})?t.status(200).send({status:!0,message:"Product deleted successfully"}):t.status(404).send({status:!1,message:"Product not found or already deleted"}):t.status(404).send({status:!1,message:"Product not found"}):t.status(400).send({status:!1,message:"Invalid product id"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getAllProductsForDashboard:async(e,t)=>{try{let e=await r.find({isDeleted:!1,stockStatus:"In_stock",status:"Approved"}).populate(["color_id","categoryId","subCatId","brandId","vendor_id"]),s=[];for(let t of e)"Approved"===t.vendor_id.status&&s.push(t);return t.status(200).send({status:!0,data:s})}catch(e){return t.status(500).send({status:!1,message:e.message})}},changeProductStatus:async(e,t)=>{try{let{newStatus:s,margin:a,sellingGST:d}=e.body,n=e.params.productId,o=await r.findById(n);if(!o)return t.status(400).send({status:!1,message:"Bad request"});if(o.status=s,"Approved"===s){if(!a||!d)return t.status(400).send({status:!1,message:"Bad request"});o.margin=a,o.sellingGST=d,o.selling_price=o.seller_price}else o.margin=void 0,o.sellingGST=void 0,o.selling_price=void 0;return await o.save(),t.status(200).send({status:!0,message:"Product updated successfully"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},changeProductStockStatus:async(e,t)=>{try{let{newStockStatus:s}=e.body,a=e.params.productId,d=await r.findById(a);return d?(d.stockStatus=s,await d.save(),t.status(200).send({status:!0,message:"Product Stock Status updated successfully"})):t.status(400).send({status:!1,message:"Bad request"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},csvProduct:async(e,t)=>{try{return t.status(200).send({status:!0,message:"Product Stock Status updated successfully",data:"xlsxUrl"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getAllProductsForFilter:async(e,t)=>{try{return products=await r.find({isDeleted:!1,stockStatus:"In_stock",status:"Approved"}).populate(["color_id","categoryId","subCatId","brandId","vendor_id"]),t.status(200).send({status:!0,data:products})}catch(e){return t.status(500).send({status:!1,message:e.message})}},updateProduct:async(e,t)=>{try{let s=e.params.productId,{product_name:a,sku_code:d,hsn_code:n,description:o,mrp:i,gst:u,seller_price:c,sellingGST:p,margin:g,qty_in_hand:y,min_order_qty:_,lotSizeQty:f,color_id:h,sole:I,material:A,packing_type:b,made_in:S,weight:N,categoryId:D,subCatId:v}=e.body,w=await r.findById(s);if(a&&(w.product_name=a),d&&(w.sku_code=d),n&&(w.hsn_code=n),o&&(w.description=o),i&&(w.mrp=i),u&&(w.gst=u),c&&(w.seller_price=c),p&&(w.sellingGST=p),g&&(w.margin=g),y&&(w.qty_in_hand=y),_&&(w.min_order_qty=_),f&&(w.lotSizeQty=f.split(",")),h&&(console.log(h),w.color_id=h),I&&(w.sole=I),A&&(w.material=A),b&&(w.packing_type=b),S&&(w.made_in=S),N&&(w.weight=N),D&&(w.categoryId=D),v&&(w.subCatId=v),e.files){let{thumbnail_pic:t,multiple_pics:s}=e.files;if(t&&(w.thumbnail_pic=await l(t)),s)if(s.length){let e=[];for(let t of s){let s=await m(t);e.push(s)}w.multiple_pics=e}else{let e=await l(s);w.multiple_pics=[e]}}return await w.save(),t.status(201).send({status:!0,message:"Product updated successfully"})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},6094:(e,t,s)=>{const a=s(7489),r=s(2545),{uploadFile:d}=s(8913),n=s(7096);e.exports={updateProfile:async(e,t)=>{try{let o=e.userId,i=e.userModel,{fullName:u,emailID:l,phone:c,altPhone:m,newPass:p,oldPass:g}=e.body;if("ADMIN"===i){let y=await a.findById(o);if(!g||!p){if(u&&(y.name=u),l&&(y.email=l),c&&l){if((await a.find({$or:[{email:l},{phone:c}]})).length>0)return t.status(400).send({status:!1,message:"Mobile and Email number already exists"});y.phone=c,y.email=l}else if(c){if((await a.find({phone:c})).length>0)return t.status(400).send({status:!1,message:"Mobile number already exists"});y.phone=c}else if(l){if((await a.find({email:l})).length>0)return t.status(400).send({status:!1,message:"Email id already exists"});y.email=l}if(e.files){let{profileImg:h}=e.files,I=await d(h);y.profileUrl=I}let _=await y.save(),f={};return f.name=_.name,f.email=_.email,f.userType=_.isSuperAdmin?"Super Admin":"Admin",f.role=_.role,f.phone=_.phone,f.photo=_.profileUrl,t.status(202).send({status:!0,message:"Profile updated successfully",data:f})}{async function s(s,r){if(s){if(r.password=await n.hash(p,10),u&&(r.name=u),l&&(r.email=l),c&&l){if((await a.find({$or:[{email:l},{phone:c}]})).length>0)return t.status(400).send({status:!1,message:"Mobile and Email number already exists"});r.phone=c,r.email=l}else if(c){if((await a.find({phone:c})).length>0)return t.status(400).send({status:!1,message:"Mobile number already exists"});r.phone=c}else if(l){if((await a.find({email:l})).length>0)return t.status(400).send({status:!1,message:"Email id already exists"});r.email=l}if(e.files){let{profileImg:t}=e.files,s=await d(t);r.profileUrl=s}let s=await r.save(),o={};return o.name=s.name,o.email=s.email,o.userType=s.isSuperAdmin?"Super Admin":"Admin",o.role=s.role,o.phone=s.phone,o.photo=s.profileUrl,t.status(202).send({status:!0,message:"Profile updated successfully",data:o})}return t.status(401).send({status:!0,message:"Invalid Password"})}n.compare(g,y.password,(function(e,t){s(t,y)}))}}else{let A=await r.findById(o);if(!g||!p){if(u&&(A.representativeName=u),m&&(A.altMobileNo=m),e.files){let{profileImg:N}=e.files,D=await d(N);A.profileUrl=D}if(c&&l){if((await r.find({$or:[{emailId:l},{mobileNo:c}]})).length>0)return t.status(400).send({status:!1,message:"Mobile and Email number already exists"});A.mobileNo=c,A.emailId=l}else if(c){if((await r.find({mobileNo:c})).length>0)return t.status(400).send({status:!1,message:"Mobile number already exists"});A.mobileNo=c}else if(l){if((await r.find({emailId:l})).length>0)return t.status(400).send({status:!1,message:"Email id already exists"});A.emailId=l}let b=await A.save(),S={};return S.name=b.representativeName,S.email=b.emailId,S.userType="Seller",S.role=b.role,S.altMobileNo=b.altMobileNo,S.phone=b.mobileNo,S.photo=b.profileUrl,S.vendorId=b.vendor_unique_id,t.status(202).send({status:!0,message:"Profile updated successfully",data:S})}{async function s(s,a){if(s){if(console.log(s),a.password=await n.hash(p,10),u&&(a.representativeName=u),m&&(a.altMobileNo=m),e.files){let{profileImg:t}=e.files,s=await d(t);a.profileUrl=s}if(c&&l){if((await r.find({$or:[{emailId:l},{mobileNo:c}]})).length>0)return t.status(400).send({status:!1,message:"Mobile and Email number already exists"});a.mobileNo=c,a.emailId=l}else if(c){if((await r.find({mobileNo:c})).length>0)return t.status(400).send({status:!1,message:"Mobile number already exists"});a.mobileNo=c}else if(l){if((await r.find({emailId:l})).length>0)return t.status(400).send({status:!1,message:"Email id already exists"});a.emailId=l}let o=await a.save(),i={};return i.name=o.representativeName,i.email=o.emailId,i.userType="Seller",i.role=o.role,i.altMobileNo=o.altMobileNo,i.phone=o.mobileNo,i.photo=o.profileUrl,i.vendorId=o.vendor_unique_id,t.status(202).send({status:!0,message:"Profile updated successfully",data:i})}return t.status(401).send({status:!0,message:"Invalid Password"})}n.compare(g,A.password,(function(e,t){s(t,A)}))}}}catch(v){return t.status(500).send({status:!1,message:v.message})}},changePassword:async(e,t)=>{let s=await r.findById(e.body.userid);s.password=await n.hash(e.body.password,10),s.save(),t.status(200).send({status:!0,message:"password changed successfully"})}}},6082:(e,t,s)=>{const a=s(4204),{isValid:r}=s(5484);e.exports={addQuestions:async(e,t)=>{try{let{questionFor:s,question:d}=e.body;if(!r(s))return t.status(400).send({status:!1,message:"QuestionFor field is required"});if(!r(d))return t.status(400).send({status:!1,message:"Question is required"});let n={questionFor:s,question:d};await a.create(n);let o=await a.find({questionFor:s,isDeleted:!1});return t.status(201).send({status:!0,message:"Question added successfully",data:o})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getAllQuestionByModel:async(e,t)=>{try{let s=e.userModel,r=await a.find({questionFor:s,isDeleted:!1});return t.status(200).send({status:!0,message:"Question fetched successfully",data:r})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getAllQuestion:async(e,t)=>{try{let e=await a.find({isDeleted:!1}),s={admin:[],vendor:[],customer:[]};for(let t of e)"ADMIN"===t.questionFor&&s.admin.push(t),"VENDOR"===t.questionFor&&s.vendor.push(t),"CUSTOMER"===t.questionFor&&s.customer.push(t);return t.status(200).send({status:!0,message:"Question fetched successfully",data:s})}catch(e){return t.status(500).send({status:!1,message:e.message})}},deleteQuestionById:async(e,t)=>{try{let s=e.params.questionid,r=await a.findById(s);if(r){r.isDeleted=!0,await r.save();let e=await a.find({questionFor:r.questionFor,isDeleted:!1});return t.status(200).send({status:!0,message:"Question fetched successfully",data:e})}return t.status(400).send({status:!1,message:"question id is not valid"})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},8506:(e,t,s)=>{const a=s(7641),r=s(272);e.exports={getOrderReport:async(e,t)=>{try{let e=await r.find({saleInvoice:{$exists:!0}}).populate(["payment_id","order_status_id"]);return t.status(200).send({status:!0,message:"Order Report fetched...",data:e})}catch(e){return t.status(500).send({status:!1,message:e.message})}},exportSaleReport:async(e,t)=>{try{let{startDate:n,endDate:o}=e.body;if(!n||!o)return t.status(400).send({status:!1,message:"Start date end end date are required"});if(new Date(n).getTime()>new Date(o).getTime())return t.status(400).send({status:!1,message:"Wrong date range"});var s=new a.Workbook,r=s.addWorksheet("Add Bulk Product");let i=[{header:"Order ID",key:"order_id"},{header:"Order Date and Time",key:"order_date"},{header:"Invoice No",key:"invoice_no"},{header:"Invoice Date",key:"invoice_date"},{header:"Order value",key:"order_value"},{header:"Order Qty",key:"order_qty"},{header:"Invoice value/confirmed value",key:"invoice_value"},{header:"Advance",key:"advance"},{header:"Discount",key:"discount"},{header:"Net Amount",key:"net_amount"},{header:"Refund",key:"refund"},{header:"Cash on delivery",key:"cash_on_delivery"}];var d={order_id:"FZ12345678",order_date:"07-08-2023 at 18:37:00",invoice_no:"FSIN2312345678",invoice_date:"07-08-2023 at 18:37:00",order_qty:"4",invoice_value:"10000",advance:"2000",discount:"1200",net_amount:"6800",refund:"00",cash_on_delivery:"6800"};return"ADMIN"===e.userModel&&(i.unshift({header:"Buyer name",key:"buyer_name"},{header:"Buyer No.",key:"buyer_no"}),d.buyer_name="SANJEET KUMAR",d.buyer_no=1234567891),r.columns=i,r.addRow(d),r.getRow(1).eachCell((e=>{e.font={bold:!0},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"F08080"}}})),t.setHeader("Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),t.setHeader("Content-Disposition","attachment; brandid.xlsx"),s.xlsx.write(t).then((()=>{t.status(200)}))}catch(e){return t.status(500).send({status:!1,message:e.message})}},exportPurchaseReport:async(e,t)=>{try{let{startDate:d,endDate:n}=e.body;if(!d||!n)return t.status(400).send({status:!1,message:"Start date end end date are required"});if(new Date(d).getTime()>new Date(n).getTime())return t.status(400).send({status:!1,message:"Wrong date range"});var s=new a.Workbook,r=s.addWorksheet("Add Bulk Product");let o=[{header:"Order ID",key:"order_id"},{header:"Order Date and Time",key:"order_date"},{header:"Invoice No",key:"invoice_no"},{header:"Invoice Date",key:"invoice_date"},{header:"Seller name",key:"seller_name"},{header:"Seller Phone No.",key:"seller_phone"},{header:"Seller GST",key:"seller_gst"},{header:"FactorEz GST\t",key:"factorez_gst"},{header:"Purchase ",key:"purchase"},{header:"Invoice value/confirmed value",key:"invoice_value"},{header:"GST Percentage",key:"gst_percentage"},{header:"Taxable value",key:"taxable_value"},{header:"Gst amount",key:"gst_amount"},{header:"Quantity",key:"quantity"},{header:"Order status",key:"order_status"}];return r.columns=o,r.addRow({order_id:"FZ12345678",order_date:"07-08-2023 at 18:37:00",invoice_no:"FSIN2312345678",invoice_date:"07-08-2023 at 18:37:00",seller_name:"Navnit Sekh",seller_phone:"1234567891",seller_gst:"09ABCDE4455R23",factorez_gst:"09ABCDE4455R23",purchase:"4000",invoice_value:"5000",gst_percentage:"18",taxable_value:"5000",gst_amount:"1000",quantity:"3",order_status:"pending"}),r.getRow(1).eachCell((e=>{e.font={bold:!0},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"F08080"}}})),t.setHeader("Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),t.setHeader("Content-Disposition","attachment; brandid.xlsx"),s.xlsx.write(t).then((()=>{t.status(200)}))}catch(e){return t.status(500).send({status:!1,message:e.message})}},getPaymentReport:async(e,t)=>{try{let e=await r.find({saleInvoice:{$exists:!0}}).populate(["vendorId","payment_id","order_status_id"]);return t.status(200).send({status:!0,message:"Payment report fetched",data:e})}catch(e){return t.status(500).send({status:!1,message:e.message})}},updatePaymentReport:async(e,t)=>{try{let s=e.params.orderid,{paymentStatus:a,paidAmount:d,paymentDate:n,transactionId:o,settlementAmt:i,message:u}=e.body,l=e.body,c=await r.findById(s);if(!c)return t.status(400).send({status:!1,message:"Order id not found"});a&&(c.paymentReportStatus.paymentStatus=a),d&&(c.paymentReportStatus.paidAmount=d),n&&(c.paymentReportStatus.paymentDate=n),o&&(c.paymentReportStatus.transactionId=o),i&&(c.paymentReportStatus.settlementAmt=i),u&&(c.paymentReportStatus.message=u),l.updateAt=new Date,c.paymentReportStatus.logs.push(l),await c.save();let m=await r.find({saleInvoice:{$exists:!0}}).populate(["vendorId","payment_id","order_status_id"]);return t.status(200).send({status:!0,message:"Payment Report Updated",data:m})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},9062:(e,t,s)=>{const a=s(2545),r=s(8512),d=s(5341),{uploadFile:n}=s(8913),{generateRandomID:o,generateRandomAlphaNumericID:i}=s(74),{isValid:u,isValidEmail:l,isValidMoblie:c,isValidGST:m}=s(5484),{roleEnums:p}=s(489),g=s(6150),y=s(7096);e.exports={getAllVendors:async(e,t)=>{try{let e=await a.find({isDeleted:!1}).populate(["bank_id","document_id","actionTakenBy","brand_id"]);return t.status(201).send({status:!0,message:"Success",data:e})}catch(e){return t.status(500).send({status:!1,message:e.message})}},addVendor:async(e,t)=>{try{let s=e.body,{firmName:u,brandName:l,gstNo:c,representativeName:m,emailId:p,password:_,mobileNo:f,altMobileNo:h,pickupState:I,pickupCity:A,pickupPincode:b,invoiceAddress:S,pickupAddress:N,acHolderName:D,acNo:v,bankName:w,branch:E,ifsc:C,termsAndConditions:O}=s;if(""===_)return t.status(400).send({message:"Password is required",status:!1});if(_=await y.hash(_,10),await a.findOne({emailId:p}))return t.status(400).send({message:"Email id already exists",status:!1});let T=await n(e.files.gstRegDoc),R=await n(e.files.brandLogo),P=await n(e.files.brandRegDoc),k=await n(e.files.cancelledCheque),q={brandRegDoc:P,gstRegDoc:T},M={acHolderName:D,acNo:v,bankName:w,branch:E,ifsc:C,cancelledCheque:k},B={brand_name:l,brandLogo:R},x={firmName:u,gstNo:c,representativeName:m,emailId:p.toLowerCase(),password:_,mobileNo:f,altMobileNo:h,pickupState:I,pickupCity:A,pickupPincode:b,invoiceAddress:S,pickupAddress:N,termsAndConditions:O},U=await d.create(q),L=await r.create(M),V=await g.create(B);x.bank_id=L,x.document_id=U,x.brand_id=V,x.vendor_unique_id=o(10),x.auth_unique_id=o(10),x.db_unique_id=i(20),x.sharing_unique_id=i(20),x.role=["VENDOR"];let G=await a.create(x);return V.vendor_id=G,await V.save(),t.status(201).send({status:!0,message:"Success"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},createVendorByAdmin:async(e,t)=>{try{let s=e.body,u=e.userId,{firmName:l,brandName:c,gstNo:m,representativeName:p,emailId:_,password:f,mobileNo:h,altMobileNo:I,pickupState:A,pickupCity:b,pickupPincode:S,invoiceAddress:N,pickupAddress:D,acHolderName:v,acNo:w,bankName:E,branch:C,ifsc:O}=(e.userModel,s);if(""===f)return t.status(400).send({message:"Password is required",status:!1});if(await a.findOne({emailId:_}))return t.status(400).send({message:"Email id already exists",status:!1});f=await y.hash(f,10);let T=await n(e.files.gstRegDoc),R=await n(e.files.brandLogo),P=await n(e.files.brandRegDoc),k=await n(e.files.cancelledCheque),q={brandRegDoc:P,gstRegDoc:T,actionTakenBy:u},M={acHolderName:v,acNo:w,bankName:E,branch:C,ifsc:O,cancelledCheque:k,actionTakenBy:u},B={brand_name:c,brandLogo:R,brandStatus:"Approved"},x={firmName:l,gstNo:m,representativeName:p,emailId:_.toLowerCase(),password:f,mobileNo:h,altMobileNo:I,pickupState:A,pickupCity:b,pickupPincode:S,invoiceAddress:N,pickupAddress:D,termsAndConditions:!0},U=await d.create(q),L=await r.create(M),V=await g.create(B);x.bank_id=L,x.document_id=U,x.brand_id=V,x.vendor_unique_id=o(10),x.auth_unique_id=o(10),x.db_unique_id=i(20),x.sharing_unique_id=i(20),x.role=["VENDOR"],x.actionTakenBy=u,x.status="Approved",x.basicInfoStatus="Approved";let G=await a.create(x);return V.vendor_id=G,await V.save(),t.status(201).send({status:!0,message:"Success"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},updateVendor:async(e,t)=>{try{let{firmName:s,gstNo:r,representativeName:d,emailId:o,password:i,mobileNo:u,altMobileNo:l,pickupState:c,pickupCity:m,pickupPincode:p,invoiceAddress:g,pickupAddress:_,brand_id:f,brand_name:h,bank_id:I,acHolderName:A,acNo:b,bankName:S,branch:N,ifsc:D}=e.body,v=e.params.vendorId,w=await a.findById(v).populate(["bank_id","document_id","brand_id"]);if(s&&(w.firmName=s),r&&(w.gstNo=r),d&&(w.representativeName=d),o&&(w.emailId=o.toLowerCase()),i&&(w.password=await y.hash(i,10)),u&&(w.mobileNo=u),l&&(w.altMobileNo=l),c&&(w.pickupState=c),c&&(w.pickupState=c),m&&(w.pickupCity=m),p&&(w.pickupPincode=p),g&&(w.invoiceAddress=g),_&&(w.pickupAddress=_),f)for(let e of w.brand_id)console.log(e),e._id.toString()===f&&(e.brand_name=h,await e.save());if(I&&(S&&(w.bank_id.bankName=S),A&&(w.bank_id.acHolderName=A),b&&(w.bank_id.acNo=b),N&&(w.bank_id.branch=N),D&&(w.bank_id.ifsc=D),await w.bank_id.save()),e.files){let{cancelledCheque:t,gstRegDoc:s,brandRegDoc:a}=e.files;t&&(w.bank_id.cancelledCheque=await n(t)),s&&(w.document_id.gstRegDoc=await n(s)),a&&(w.document_id.brandRegDoc=await n(a)),await w.document_id.save()}await w.save(),t.status(201).send({status:!0,message:"successfully",data:w})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},4939:(e,t,s)=>{const{isValidObjectId:a}=s(1185),r=s(9074),d=s(752),n=s(6443);e.exports={addToWishlist:async(e,t)=>{try{let{productId:s}=e.body;if(!s)return t.status(400).send({status:!1,message:"bad request"});if(!a(s))return t.status(400).send({status:!1,message:"invalid product id"});if(!await r.findById(s))return t.status(400).send({status:!1,message:"product not found"});if(await d.findOne({productId:s,userId:e.userId}))return t.status(200).send({status:!1,message:"Already in wishlist"});let o=await n.findById(e.userId).populate("cart_id");await d.create({productId:s,userId:o._id});let i=await d.find({userId:o._id}),u={name:o.name,email:o.email,customerId:o._id.toString(),userType:"CUSTOMER",isActivated:o.isActivated,phone:o.phone,cartLength:o.cart_id.products.length,wishlistLength:i.length};t.status(201).send({status:!0,data:u,message:"Added to wishlist"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},removeFromWishlist:async(e,t)=>{try{let s=e.params.wishlistId;if(!s)return t.status(400).send({status:!1,message:"bad request"});if(!a(s))return t.status(400).send({status:!1,message:"invalid wishlist id"});if(!await d.findOneAndDelete({userId:e.userId,productId:s}))return t.status(400).send({status:!1,message:"Bad request"});t.status(200).send({status:!0,message:"Removed from wishlist"})}catch(e){return t.status(500).send({status:!1,message:e.message})}},getWishlistProduct:async(e,t)=>{try{let s=await d.find({userId:e.userId}).populate("productId");t.status(200).send({status:!0,data:s,message:"Wishlist fetched"})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},3350:(e,t,s)=>{const a=s(7489),r=(s(2545),s(6443),s(9344)),{tokenSecretKey:d,customerTokenSecretKey:n}=s(341),{isValidObjectId:o}=s(1185);e.exports={Authentication:async(e,t,s)=>{try{let a=e.headers.authorization;if(!a)return t.status(400).send({status:!1,message:"token is required"});let n=a.split(" ")[1];if(!n)return t.status(401).send({status:!1,message:"Invalid token"});r.verify(n,d,(function(a,r){if(a)return t.status(400).send({status:!1,message:a.message});e.userId=r.userId,e.userModel=r.userModel,e.userPhone=r.phone?r.phone:"",s()}))}catch(e){return t.status(500).send({status:!1,message:e.message})}},Authorization:async(e,t,s)=>{try{let r=e.userId,d=e.params.userId;if(!o(d))return t.status(400).send({status:!1,message:"Invalid admin id"});let n=await a.findById(d);if(!n)return t.status(404).send({status:!1,message:"Admin not found"});if(n._id.toString()!==r.toString())return t.status(403).send({status:!1,message:"authorization failed"});s()}catch(e){return t.status(500).send({status:!1,message:e.message})}},AuthenticationCustomer:async(e,t,s)=>{try{let a=e.headers.authorization;if(!a)return t.status(400).send({status:!1,message:"token is required"});let d=a.split(" ")[1];if(!d)return t.status(401).send({status:!1,message:"Invalid token"});r.verify(d,n,(function(a,r){if(a)return t.status(400).send({status:!1,message:a.message});e.userId=r.userId,e.userModel=r.userModel,e.userPhone=r.phone?r.phone:"",s()}))}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},341:(e,t,s)=>{s(5142).config(),e.exports={mongoDbUrl:process.env.MONGO_DB_URL,tokenSecretKey:process.env.TOKEN_SECRET_KEY,customerTokenSecretKey:process.env.CUSTOMER_TOKEN_SECRET_KEY,port:process.env.PORT,apiKey:process.env.FIREBASE_API_KEY,authDomain:process.env.FIREBASE_AUTH_DOMAIN,projectId:process.env.FIREBASE_PROJECT_ID,storageBucket:process.env.FIREBASE_STORAGE_BUCKET,messagingSenderId:process.env.FIREBASE_MESSAGING_SENDER_ID,appId:process.env.FIREBASE_APP_ID,measurementId:process.env.FIREBASE_MEASUREMENT_ID,adminSecretKey:process.env.ADMIN_SECRET_KEY,twilioAuthToken:process.env.TWILIO_AUTH_TOKEN,twilioAccSID:process.env.TWILIO_ACCOUNT_SID,twilioVerifySID:process.env.TWILIO_VERIFY_SID,awsAccessKey:process.env.AWS_ACCESS_KEY_ID,awsSecretKey:process.env.AWS_SECRET_ACCESS_KEY,awsS3Region:process.env.S3_REGION,awsS3Bucket:process.env.S3_BUCKET}},6752:(e,t,s)=>{const a=s(5142),{apiKey:r,authDomain:d,projectId:n,storageBucket:o,messagingSenderId:i,appId:u,measurementId:l}=s(341);a.config();const c={apiKey:r,authDomain:d,projectId:n,storageBucket:o,messagingSenderId:i,appId:u,measurementId:l};e.exports={firebaseConfig:c}},3166:(e,t,s)=>{const a=s(7489);s(6443);let r=s(2545);const{roleEnums:d,accessControls:n}=s(489),o=async(e,t)=>{let s=null;if("ADMIN"===e.userModel?s=await a.findOne({_id:e.userId}):"VENDOR"===e.userModel&&(s=await r.findOne({_id:e.userId})),!s)return!1;e.userData=s;for(let e of s.role)if(t.includes(e))return!0;return!1};e.exports={AddProductRole:async(e,t,s)=>{try{e.userId,await a.findOne({_id:e.userId}),s()}catch(e){return t.status(500).send({status:!1,message:e.message})}},AllProductRole:async(e,t,s)=>{try{let a=[n.PRODUCT.PRODUCT_ALL_PRODUCT,n.PRODUCT.ACCESS.PRODUCT_DOWNLOAD,n.PRODUCT.ACCESS.PRODUCT_EDIT,n.PRODUCT.ACCESS.PRODUCT_VIEW,n.PRODUCT.PRODUCT_ADD_PRODUCT,"ADMIN"];return"VENDOR"===e.userModel||await o(e,a)?void s():t.status(401).send({message:"You don't have permission for this action",status:!1})}catch(e){return t.status(500).send({status:!1,message:e.message})}},AllMenuRole:async(e,t,s)=>{try{let d,o=[n.PRODUCT.ACCESS.PRODUCT_DOWNLOAD,"ADMIN"];"admin"===e.userModel?d=await a.findOne({_id:e.userId}):"vendor"===e.userModel&&(d=await r.findOne({_id:e.userId})),e.userData=d;for(let e of d.role)if(o.includes(e))return void s();return t.status(401).send({message:"You don't have permission for this action",status:!1})}catch(e){return t.status(500).send({status:!1,message:e.message})}},AllVendorRoles:async(e,t,s)=>{try{let r,d=[n.VENDOR.ACCESS.VENDOR_DOWNLOAD,n.VENDOR.ACCESS.VENDOR_EDIT,n.VENDOR.ACCESS.VENDOR_VIEW,n.VENDOR.VENDOR_ADD_VENDOR,n.VENDOR.VENDOR_ALL_VENDOR,n.VENDOR.VENDOR_VENDOR_MOV,n.VENDOR.VENDOR_VENDOR_PAYMENT,"ADMIN"];"admin"===e.userModel&&(r=await a.findOne({_id:e.userId})),e.userData=r;for(let e of r.role)if(d.includes(e))return void s();return t.status(401).send({message:"You don't have permission for this action",status:!1})}catch(e){return t.status(500).send({status:!1,message:e.message})}},AddProductColorRole:async(e,t,s)=>{try{let r,n=[d.MANAGE_PRODUCT.PRODUCT_COLOR,"ADMIN"];"admin"===e.userModel&&(r=await a.findOne({_id:e.userId})),e.userData=r;for(let e of r.role)if(n.includes(e))return void s();return t.status(401).send({message:"You don't have permission for this action",status:!1})}catch(e){return t.status(500).send({status:!1,message:e.message})}},AddProductBrandRole:async(e,t,s)=>{try{let n,o=[d.MANAGE_PRODUCT.BRAND,"ADMIN"];"admin"===e.userModel?n=await a.findOne({_id:e.userId}):"vendor"===e.userModel&&(n=await r.findOne({_id:e.userId})),e.userData=n;for(let e of n.role)if(o.includes(e))return void s();return t.status(401).send({message:"You don't have permission for this action",status:!1})}catch(e){return t.status(500).send({status:!1,message:e.message})}},ManageOrderRole:async(e,t,s)=>{try{let d=[n.ORDERS.ORDERS_ABANDONED_ORDERS,n.ORDERS.ORDERS_ALL_ORDERS,n.ORDERS.ORDERS_CHANGE_ORDER_STATUS,n.ORDERS.ACCESS.ORDERS_DOWNLOAD,n.ORDERS.ACCESS.ORDERS_EDIT,n.ORDERS.ACCESS.ORDERS_VIEW,"ADMIN"],o=null;"admin"===e.userModel?o=await a.findOne({_id:e.userId}):"vendor"===e.userModel&&(o=await r.findOne({_id:e.userId})),e.userData=o;for(let e of o.role)if(d.includes(e))return void s();return t.status(401).send({message:"You don't have permission for this action",status:!1})}catch(e){return t.status(500).send({status:!1,message:e.message})}},colorRole:async(e,t,s)=>{try{let a=[d.MANAGE_PRODUCT.PRODUCT_COLOR,"ADMIN"];return await o(e,a)?void s():t.status(401).send({message:"You don't have permission for this action",status:!1})}catch(e){return t.status(500).send({status:!1,message:e.message})}},verifyProudct:async(e,t,s)=>{try{let a=[d.MANAGE_PRODUCT.PRODUCT_REVIEW,"ADMIN"];return await o(e,a)?void s():t.status(401).send({message:"You don't have permission for this action",status:!1})}catch(e){return t.status(500).send({status:!1,message:e.message})}},outOfStockProduct:async(e,t,s)=>{try{if(console.log(e.userModel),"VENDOR"===e.userModel)return void s();let a=[d.MANAGE_PRODUCT.PRODUCT_REVIEW,"ADMIN"];return await o(e,a)?void s():t.status(401).send({message:"You don't have permission for this action",status:!1})}catch(e){return t.status(500).send({status:!1,message:e.message})}},abandonedOrderRole:async(e,t,s)=>{try{return"ADMIN"===e.userModel?void s():t.status(401).send({message:"You don't have permission for this action",status:!1})}catch(e){return t.status(500).send({status:!1,message:e.message})}}}},5831:(e,t,s)=>{const a=s(1185),r=a.Schema.Types.ObjectId,d=new a.Schema({featuredProduct:[{type:r,ref:"Product"}],newArrival:[{type:r,ref:"Product"}],bestSelling:[{type:r,ref:"Product"}]},{timestamps:!0});e.exports=a.model("Homepage",d)},7489:(e,t,s)=>{const a=s(1185),{listOfRoleEnums:r,listOfAccessControll:d}=s(489),n=(a.Schema.Types.ObjectId,new a.Schema({name:{type:String,required:!0,trim:!0},email:{type:String,required:!0,unique:!0,trim:!0},phone:{type:String,required:!0,unique:!0,trim:!0},password:{type:String,required:!0,trim:!0},role:[{type:String,enum:d()}],profileUrl:{type:String,trim:!0},isSuperAdmin:{type:Boolean,default:!1},isDeleted:{type:Boolean,default:!1}},{timestamps:!0}));e.exports=a.model("Admin",n)},8512:(e,t,s)=>{const a=s(1185),r=a.Schema.Types.ObjectId,d=new a.Schema({acHolderName:{type:String,trim:!0},acNo:{type:String,trim:!0},bankName:{type:String,trim:!0},branch:{type:String,trim:!0},ifsc:{type:String,trim:!0},cancelledCheque:{type:String},actionTakenBy:{type:r,ref:"Admin"}},{timestamps:!0});e.exports=a.model("Bank",d)},9359:(e,t,s)=>{const a=s(1185),r=(a.Schema.Types.ObjectId,new a.Schema({bannerUrl:{type:String,required:!0},type:{type:String,enum:["SINGLE","MULTIPLE"],required:!0}},{timestamps:!0}));e.exports=a.model("Banner",r)},6150:(e,t,s)=>{const a=s(1185),r=a.Schema.Types.ObjectId,d=new a.Schema({brand_name:{type:String,required:!0},brandLogo:{type:String},vendor_id:{type:r,ref:"Vendor"},brandStatus:{type:String,enum:["Approved","Rejected","Pending"],default:"Pending"},isDeleted:{type:Boolean,default:!1},deletedAt:{type:Date,default:null}},{timestamps:!0});e.exports=a.model("Brand",d)},6756:(e,t,s)=>{const a=s(1185),r=(a.Schema.Types.ObjectId,new a.Schema({business_name:{type:String},business_Logo:{type:String},invoiceLogo:{type:String},contactNo:{type:String},contactEmail:{type:String},socialMedia:{facebook:{type:String},instagram:{type:String},twitter:{type:String},linkedin:{type:String},youtube:{type:String}},privacyPolicy:{type:String},iAgree:{type:String},gsts:[{gstNo:{type:String},pickupAddress:{type:String},stateCode:{type:String}}],defaultGST:{gstNo:{type:String},pickupAddress:{type:String},stateCode:{type:String}}},{timestamps:!0}));e.exports=a.model("Business",r)},2930:(e,t,s)=>{const a=s(1185),r=a.Schema.Types.ObjectId,d=new a.Schema({questions:{type:r,ref:"Question"},customerAnswer:{type:String}},{timestamps:!0});e.exports=a.model("Cancelled_Reason",d)},1277:(e,t,s)=>{const a=s(1185),r=a.Schema.Types.ObjectId,d=new a.Schema({products:[{product_id:{type:r,ref:"Product"},qty:{type:Number},lotSize:{type:String},color:{colorName:{type:String},colorHex:{type:String}},addedAt:{type:String}}],customer_id:{type:r,ref:"Customer"}},{timestamps:!0});e.exports=a.model("Cart",d)},7227:(e,t,s)=>{const a=s(1185),r=a.Schema.Types.ObjectId,d=new a.Schema({category_name:{type:String,required:!0},sub_category:[{type:r,ref:"Subcategory"}],isDeleted:{type:Boolean,default:!1},deletedAt:{type:Date,default:null}},{timestamps:!0});e.exports=a.model("Category",d)},6421:(e,t,s)=>{const a=s(1185),r=a.Schema.Types.ObjectId,d=new a.Schema({colorName:{type:String,trim:!0,unique:!0},colorHex:{type:String,trim:!0,unique:!0},products:[{type:r,ref:"Product"}],isDeleted:{type:Boolean,default:!1}},{timestamps:!0});e.exports=a.model("Color",d)},6632:(e,t,s)=>{const a=s(1185),r=a.Schema.Types.ObjectId,d=new a.Schema({customer_id:[{type:r,ref:"Customer"}],couponCode:{type:String,required:!0},validTill:{type:Date,required:!0},maxUsers:{type:Number,required:!0},minOrderAmt:{type:Number,required:!0},isUsed:{type:Boolean,default:!1},isExpired:{type:Boolean,default:!1},isDeleted:{type:Boolean,default:!1},generatedBy:{type:r,ref:"Admin"},maxDiscPrice:{type:Number,required:!0},discountType:{type:String,enum:["PRICE","PERCENTAGE"],required:!0},discountAmt:{type:Number,required:!0}},{timestamps:!0});e.exports=a.model("CouponCode",d)},4935:(e,t,s)=>{const a=s(1185),r=a.Schema.Types.ObjectId,d=new a.Schema({customerId:{type:r,ref:"Customer"},address:{type:String,required:!0},state:{type:String,required:!0},city:{type:String,required:!0},pincode:{type:String,required:!0},stateCode:{type:String,required:!0},isDeleted:{type:Boolean,default:!1},deletedAt:{type:Date,default:null}},{timestamps:!0});e.exports=a.model("CustomerAddress",d)},6443:(e,t,s)=>{const a=s(1185),r=a.Schema.Types.ObjectId,d=new a.Schema({name:{type:String},defaultAddress:{type:r,ref:"CustomerAddress"},gstNo:{type:String},phone:{type:String,required:!0},alternate_phone:{type:String},email:{type:String},profileUrl:{type:String,trim:!0},password:{type:String},isActivated:{type:Boolean,default:!1},isBlocked:{type:Boolean,default:!1},cart_id:{type:r,ref:"Cart"},orders:[{type:r,ref:"Order"}],isDeleted:{type:Boolean,default:!1},deletedAt:{type:Date,default:null}},{timestamps:!0});e.exports=a.model("Customer",d)},5341:(e,t,s)=>{const a=s(1185),r=a.Schema.Types.ObjectId,d=new a.Schema({brandRegDoc:{type:String},gstRegDoc:{type:String},actionTakenBy:{type:r,ref:"Admin"}},{timestamps:!0});e.exports=a.model("Document",d)},9939:(e,t,s)=>{const a=s(1185),r=a.Schema.Types.ObjectId,d=new a.Schema({invoiceNo:{type:String,required:!0},invoiceDate:{type:Date,required:!0},invoiceType:{type:String,enum:["PURCHASE","SALE"],required:!0},customer_id:{type:r,ref:"Customer"},vendor_id:{type:r,ref:"Vendor"},order_id:{type:r,ref:"Order"},gstAmount:{type:Number,required:!0},gstType:{type:String,enum:["CGST_SGST","IGST"],required:!0},totalAmount:{type:Number,required:!0},invoiceStatus:{type:String,enum:["PAID","UNPAID","OVERDUE"],default:"UNPAID"},soldBy:{name:{type:String},address:{type:String},phone:{type:String},gst:{type:String}},shippingAddress:{name:{type:String},address:{type:String,required:!0},phone:{type:String},gst:{type:String}},billingAddress:{name:{type:String},address:{type:String,required:!0},phone:{type:String},gst:{type:String}}},{timestamps:!0});e.exports=a.model("Invoice",d)},7355:(e,t,s)=>{const a=s(1185),r=(a.Schema.Types.ObjectId,new a.Schema({invoiceNo:{type:Number,default:0,required:!0},invoiceYear:{type:Number,default:23,required:!0},invoiceNoLength:{type:Number,default:9,required:!0},invoiceNoType:{type:String,enum:["PURCHASE","SALE"],required:!0}},{timestamps:!0}));e.exports=a.model("InvoiceNo",r)},272:(e,t,s)=>{const a=s(1185),r=a.Schema.Types.ObjectId,d=new a.Schema({orderId:{type:String},vendorId:{type:r,ref:"Vendor"},vendorAmtInfo:{grandTotal:{type:Number},gstAmt:{type:Number},total:{type:Number}},transaction_id:{type:String},shipping_charges:{type:Number},grand_total:{type:Number,default:0},total:{type:Number,default:0},total_pairs:{type:Number},GST_amount:{type:Number},discounted_amount:{type:Number,default:0},order_date:{type:Date},tracking_id:{type:String},transport_bilty:{type:String},ordered_products:{type:r,ref:"Ordered_Product"},order_status_id:{type:r,ref:"Order_Status_Table"},payment_id:{type:r,ref:"Payment"},customer_id:{type:r,ref:"Customer"},shipping_address:{stateCode:{type:String},state:{type:String},address:{type:String}},couponCode:{type:r,ref:"CouponCode"},saleInvoice:{type:r,ref:"Invoice"},purchaseInvoice:{type:r,ref:"Invoice"},paymentReportStatus:{paymentStatus:{type:String,enum:["PENDING","DUE","PARTIAL_PAID","FULL_PAID","SETTLED_PAID"],default:"PENDING"},paidAmount:{type:Number},paymentDate:{type:Date},transactionId:{type:String},settlementAmt:{type:Number},message:{type:String},logs:[]},partialCancelOrderInfo:{orderedAmtInfo:{grand_total:{type:Number},total:{type:Number},GST_amount:{type:Number}},orderedProductAmtInfo:{productQty:{type:Number},grand_total:{type:Number},total:{type:Number},GST_amount:{type:Number}}}},{timestamps:!0});e.exports=a.model("Order",d)},8536:(e,t,s)=>{const a=s(1185),r=a.Schema.Types.ObjectId,d=new a.Schema({order_id:{type:r,ref:"Order",required:!0},status:{type:String,enum:["PENDING","CONFIRMED","PARTIAL_CONFIRMED","READY_TO_DISPATCH","PICKUP_ALIGNED","PICKUP_DONE","RETURNED","RETURNED_RTO","RETURNED_RTO_DELIVERED","DELIVERED","CANCELLED","OUT_FOR_DELIVERY"],default:"PENDING"},isCompleted:{type:Boolean,default:!1},statusList:[{status:{type:String,enum:["CONFIRMED","PARTIAL_CONFIRMED","READY_TO_DISPATCH","PICKUP_ALIGNED","PICKUP_DONE","RETURNED","RETURNED_RTO","RETURNED_RTO_DELIVERED","DELIVERED","OUT_FOR_DELIVERY"]},updatedBy:{vendor:{type:r,ref:"Vendor"},admin:{type:r,ref:"Admin"}},updatedAt:{type:Date}}],cancelled:{cancelledBy:{type:String,enum:["Super_Admin","Vendor","Customer"]},userId:{vendor:{type:r,ref:"Vendor"},admin:{type:r,ref:"Admin"},customer:{type:r,ref:"Customer"}},question:{type:r,ref:"Question"},description:{type:String}},cancelledStatus:{type:String,enum:["PICKUP_ALIGNED","PICKUP_DONE","RETURNED","RETURNED_RTO","RETURNED_RTO_DELIVERED","CANCELLED"]},cancelledStatusList:[{status:{type:String,enum:["PICKUP_ALIGNED","PICKUP_DONE","RETURNED","RETURNED_RTO","RETURNED_RTO_DELIVERED","CANCELLED"]},updatedBy:{vendor:{type:r,ref:"Vendor"},admin:{type:r,ref:"Admin"},customer:{type:r,ref:"Customer"}},updatedAt:{type:Date}}]},{timestamps:!0});e.exports=a.model("Order_Status_Table",d)},2891:(e,t,s)=>{const a=s(1185),r=a.Schema.Types.ObjectId,d=new a.Schema({products:[{product_id:{type:r,ref:"Product",required:!0},vendor_id:{type:r,ref:"Vendor",required:!0},mrp:{type:Number,required:!0},seller_price:{type:Number,required:!0},seller_gst:{type:Number,required:!0},selling_price:{type:Number,required:!0},selling_gst:{type:Number,required:!0},margin:{type:Number,required:!0},lotSize:{type:String},color:{colorName:{type:String},colorHex:{type:String}},hsnCode:{type:String},skuCode:{type:String},qty:{type:Number,required:!0},addedAt:{type:String},isRemoved:{type:Boolean,default:!1}}],order_id:{type:r,ref:"Order"}},{timestamps:!0});e.exports=a.model("Ordered_Product",d)},4555:(e,t,s)=>{const a=s(1185),r=(a.Schema.Types.ObjectId,new a.Schema({mobile:{type:String,required:!0},otp:{type:String},createdAt:{type:Date,default:Date.now(),index:{expires:300}}},{timestamps:!0}));e.exports=a.model("OTP",r)},8462:(e,t,s)=>{const a=s(1185),r=a.Schema.Types.ObjectId,d=new a.Schema({paymentId:{type:String,required:!0},order_id:{orderId:{type:r,ref:"Order"},order_custom_id:{type:String}},customer_id:{type:r,ref:"Customer"},order_status:{type:String,enum:["PENDING","CONFIRMED","PARTIAL_CONFIRMED","READY_TO_DISPATCH","PICKUP_ALIGNED","PICKUP_DONE","RETURNED","RETURNED_RTO","RETURNED_RTO_DELIVERED","DELIVERED","CANCELLED","OUT_FOR_DELIVERY"],default:"PENDING"},payment_status:{type:String,enum:["PENDING","PARTIAL_PAID","RECEIVED","FAILED","PARTIAL_REFUNDED","REFUNDED"]},payment_mode:{type:String,enum:["COD","CUSTOM","TWENTY_ADV","PREPAID"]},transactionId:{type:String},payment_amount:{type:Number,default:0},return_amount:{type:Number,default:0},cod_received:{type:Number,default:0},payment_date:{type:Date},partial_payment:{payment_amount:{type:Number},date:{type:Date},transactionId:{type:String}},order_amount:{type:Number,default:0},discount_amt:{type:Number,default:0},balance_amount:{type:Number}},{timestamps:!0});e.exports=a.model("Payment",d)},9074:(e,t,s)=>{const a=s(1185),r=s(3673),d=a.Schema.Types.ObjectId,n=new a.Schema({product_name:{type:String,required:!0,trim:!0},sku_code:{type:String,required:!0,trim:!0},hsn_code:{type:String,required:!0,trim:!0},description:{type:String,required:!0},mrp:{type:Number,required:!0},gst:{type:Number,required:!0},seller_price:{type:Number},sellingGST:{type:Number},margin:{type:Number},stockStatus:{type:String,enum:["In_stock","Out_of_stock"],default:"In_stock"},qty_in_hand:{type:Number},min_order_qty:{type:Number},lotSizeQty:[{type:String,required:!0,trim:!0}],color_id:[{type:d,ref:"Color"}],sole:{type:String,trim:!0,default:""},material:{type:String,trim:!0,default:""},packing_type:{type:String,trim:!0,default:""},made_in:{type:String,trim:!0,default:"India"},weight:{type:Number},categoryId:{type:d,ref:"Category",required:!0},subCatId:{type:d,ref:"Subcategory",required:!0},thumbnail_pic:{type:String},multiple_pics:[{type:String}],meta_title:{type:String},meta_keywords:{type:String},meta_description:{type:String},slug:{type:String,required:!0,trim:!0},status:{type:String,enum:["Approved","Pending","Rejected"],default:"Pending"},brandId:{type:d,ref:"Brand"},vendor_id:{type:d,ref:"Vendor"},isDeleted:{type:Boolean,default:!1},deletedAt:{type:Date,default:null}},{timestamps:!0});n.pre("validate",(function(e){if(this.product_name){let e=this.product_name+" "+this.sku_code;this.slug=r(e,{lower:!0,strict:!0})}e()})),e.exports=a.model("Product",n)},4204:(e,t,s)=>{const a=s(1185),r=(a.Schema.Types.ObjectId,new a.Schema({questionFor:{type:String,enum:["ADMIN","CUSTOMER","VENDOR"]},question:{type:String},isDeleted:{type:Boolean,default:!1}},{timestamps:!0}));e.exports=a.model("Question",r)},2115:(e,t,s)=>{const a=s(1185),r=a.Schema.Types.ObjectId,d=new a.Schema({subcategory_name:{type:String,required:!0},productId:[{type:r,ref:"Product"}],isDeleted:{type:Boolean,default:!1},deletedAt:{type:Date,default:null}},{timestamps:!0});e.exports=a.model("Subcategory",d)},2545:(e,t,s)=>{const a=s(1185),{listOfRoleEnums:r,listOfAccessControll:d}=s(489),n=a.Schema.Types.ObjectId,o=new a.Schema({firmName:{type:String,required:!0,trim:!0},gstNo:{type:String,trim:!0},representativeName:{type:String,required:!0,trim:!0},profileUrl:{type:String,trim:!0},emailId:{type:String,trim:!0},password:{type:String,trim:!0},mobileNo:{type:String,required:!0,unique:!0,trim:!0},altMobileNo:{type:String,trim:!0},pickupState:{type:String,trim:!0},pickupCity:{type:String,trim:!0},pickupPincode:{type:String,trim:!0},invoiceAddress:{type:String,trim:!0},pickupAddress:{type:String,trim:!0},termsAndConditions:{type:Boolean,required:!0},bank_id:{type:n,ref:"Bank"},document_id:{type:n,ref:"Document"},brand_id:[{type:n,ref:"Brand"}],vendor_unique_id:{type:String,unique:!0,trim:!0},auth_unique_id:{type:String,unique:!0,trim:!0},db_unique_id:{type:String,unique:!0,trim:!0},sharing_unique_id:{type:String,unique:!0,trim:!0},basicInfoStatus:{type:String,enum:["Approved","Rejected","Pending"],default:"Pending"},products:[{type:n,ref:"Product"}],orders:[{type:n,ref:"Order"}],order_success:[{type:n,ref:"Order_Success"}],order_canclled:[{type:n,ref:"Order_Cancelled"}],order_pending:[{type:n,ref:"Order_Pending"}],order_inprogress:[{type:n,ref:"Order_Inprogress"}],logistics_id:{type:n,ref:"Logistics"},business_id:{type:n,ref:"Business"},status:{type:String,enum:["Pending","Rejected","Inprogress","Approved"],default:"Pending"},isActive:{type:String,enum:["Active","Inactive","Blocked"],default:"Active"},actionTakenBy:{type:n,ref:"Admin"},marginInPercentage:{type:Number},isDeleted:{type:Boolean,default:!1},role:[{type:String,enum:"VENDOR"}]},{timestamps:!0});e.exports=a.model("Vendor",o)},752:(e,t,s)=>{const a=s(1185),r=a.Schema.Types.ObjectId,d=new a.Schema({productId:{type:r,ref:"Product",required:!0},userId:{type:r,ref:"Customer",required:!0}},{timestamps:!0});e.exports=a.model("Wishlist",d)},534:(e,t,s)=>{const a=s(6860),{Authentication:r}=s(3350),{getDashboardData:d}=s(3241),n=a.Router();n.get("/admin-dashboard",r,d),e.exports=n},9683:(e,t,s)=>{const a=s(6860).Router(),r=s(5950),{Authentication:d}=s(3350),{AddProductRole:n}=s(3166),{uploadFile:o}=s(8913);a.post("/addadmin",d,r.addAdmin),a.get("/getadmin",d,r.getAllAdmin),a.put("/update-admin/:adminid",d,r.updateAdminInfo),a.delete("/delete-admin/:adminid",d,r.deleteAdminById),a.post("/adminlogin",r.adminLogin),a.post("/createsuperadmin/:secretKey",r.createSuperAdmin),a.get("/alladminenums",d,r.getAllSubadminEnums),a.put("/verifyvendor/:vendorId",d,r.verifyVendor),a.put("/changevendorpassword",r.changeVendorPassword),a.delete("/deleteVendor",d,r.deleteVendor),e.exports=a},5806:(e,t,s)=>{const a=s(6860).Router(),r=s(3749),{Authentication:d}=s(3350);a.post("/brand",d,r.addBrand),a.get("/brands",d,r.getAllBrands),a.get("/brands/:vendorId",d,r.getAllBrandByVendor),a.patch("/verifybrand/:brandId",d,r.verifyBrandById),e.exports=a},8908:(e,t,s)=>{const a=s(6860).Router(),{addBusinessInfo:r,saveSocialMedia:d,addBusinessGST:n,getBusinessInfo:o,addBusinessFiles:i,setDefaultGst:u,bannerForClientPage:l,getBannerForClientPage:c,bannerDeleteById:m}=s(6795),{Authentication:p,AuthenticationCustomer:g}=s(3350);a.post("/addbusinessinfo",p,r),a.post("/addbusinessgst",p,n),a.get("/getbusinessinfo",p,o),a.post("/addbusinessfiles",p,i),a.patch("/updatedefgst",p,u),a.post("/savesocialmedia",p,d),a.post("/bannerupload",p,l),a.get("/bannerimages",p,c),a.get("/bannerimagesforclient",g,c),a.delete("/deletebanner/:bannerId",p,m),e.exports=a},8783:(e,t,s)=>{const a=s(6860).Router(),{addToCart:r,getAllAbandentCarts:d,getCartByCustomerId:n,removeFromCart:o,qtyIncreaseDecrease:i}=s(8329),{Authentication:u,AuthenticationCustomer:l}=s(3350),{abandonedOrderRole:c}=s(3166);a.post("/addtocart/:customerId",l,r),a.get("/cart/:customerId",n),a.get("/abandonedcarts",u,c,d),a.put("/removefromcart/:customerId/:index",l,o),a.put("/qty-increase-decrease/:customerId/:index/:qty",l,i),e.exports=a},882:(e,t,s)=>{const a=s(6860).Router(),r=s(5761);a.post("/category",r.addCategory),a.get("/categories",r.getAllCategories),a.put("/category/:categoryId",r.updateCategoryById),e.exports=a},6461:(e,t,s)=>{const a=s(6860).Router(),{Authentication:r}=s(3350),{colorRole:d}=s(3166),{getAllColor:n,addNewColor:o,deleteColorById:i}=s(4976);a.get("/getallcolors",n),a.post("/addnewcolor",r,d,o),a.delete("/deletecolorbyid/:colorId",r,d,i),e.exports=a},4632:(e,t,s)=>{const a=s(6860),{getAllCoupons:r,generateCoupon:d,applyCoupon:n,deleteCoupon:o}=s(8147),i=a.Router();i.get("/allcoupon",r),i.post("/generatecoupon",d),i.post("/applycoupon/:customerid",n),i.patch("/deletecoupon/:couponid",o),e.exports=i},8:(e,t,s)=>{const a=s(6860).Router(),r=s(3842),d=s(6052),{Authentication:n,AuthenticationCustomer:o}=s(3350);a.post("/login-customer",r.loginUser),a.get("/customers",n,r.getAllCustomer),a.get("/customer/:customerId",n,r.getCustomerById),a.put("/updatecustomer/:customerId",o,r.updateCustomerById),a.delete("/customer/:customerId",n,r.deleteCustomerById),a.post("/addcustomrinformation/:customerid",d.addCustomerInformation),a.delete("/address/:customerId/:addressId",o,d.deleteAddressById),a.patch("/blockcustomer/:customerId",n,r.blockCustomerById),a.post("/getordersbycustomerphone",n,r.findOrdersByPhone),a.post("/addaddress/:customerId",o,d.addAddress),a.get("/getalladdress/:customerId",o,d.getAllAddresses),a.put("/setdefaultaddress/:customerId/:addressId",o,r.setDefaultAddress),a.post("/change-password/:customerId",n,r.changePassword),e.exports=a},2996:(e,t,s)=>{const a=s(6860),{AuthenticationCustomer:r}=s(3350),{getDashboardData:d,getProductBySlug:n}=s(3602),o=a.Router();o.get("/get-store-info",d),o.get("/get-product-info-by-id/:slug",n),e.exports=o},4933:(e,t,s)=>{const a=s(6860),{Authentication:r}=s(3350),{addFeaturedProducts:d,removeFeaturedProduct:n,getFeaturedProduct:o}=s(6160),i=a.Router();i.post("/bestsellingproducts",r,d),i.post("/removebestsellingproduct",r,n),i.get("/allbestsellingproduct",r,o),e.exports=i},1670:(e,t,s)=>{const a=s(6860).Router(),{Authentication:r,AuthenticationCustomer:d}=s(3350),{getAllPurchaseInvoice:n,getAllSaleInvoice:o,downoadInvoiceByInvoiceNumber:i}=s(7628);a.get("/purchaseinvoice",r,n),a.get("/saleinvoice",r,o),a.get("/downloadpdf/:invoicenumber/:invoicetype",r,i),a.get("/customer-downloadpdf/:invoicenumber/:invoicetype",d,i),e.exports=a},4643:(e,t,s)=>{const a=s(6860).Router(),r=s(4154),{Authentication:d,AuthenticationCustomer:n}=(s(9352),s(3350)),{exportOrderReport:o}=(s(2891),s(6791));a.get("/orders",d,r.getAllOrders),a.get("/order/:customerId/:orderId",n,r.getOrderByOrderId),a.get("/orders/:customerId",n,r.getOrdersByCustomerId),a.get("/orderedproduct/:orderedproductid",r.getOrderedProduct),a.post("/createorder/:customerId",r.createOrder),a.put("/cancelorder/:orderId",r.cancelOrderByOrderId),a.put("/updateorder/:orderId",d,r.updateOrderByOrderId),a.patch("/patchtrackingid/:orderId",r.patchTrackingIdByOrderId),a.get("/getcancelledorders",d,r.getAllCancelledOrder),a.post("/order-report",d,o),e.exports=a},384:(e,t,s)=>{const a=s(6860).Router(),r=s(9352),{Authentication:d}=s(3350);a.post("/change-order-status/:orderId",d,r.updateOrderStatusByOrderId),a.post("/change-bulk-order-status",d,r.bulkOrderProcess),a.post("/return-order-status/:orderId",d,r.cancelOrderReturnById),e.exports=a},1399:(e,t,s)=>{const a=s(6860),{sendOTP:r,verityOTP:d,forgetPasswordUsingOtp:n}=s(3500),{sentOTP:o,verifyOTP:i}=s(4649),u=a.Router();u.get("/verifyotp/:phone/:otpCode",d),u.post("/forget-password/:phone/:otpCode",n),u.post("/sendOTP",o),u.post("/verifyOTP",i),e.exports=u},4965:(e,t,s)=>{const a=s(6860).Router(),r=s(9472),{Authentication:d}=s(3350);a.post("/addpayment/:orderId",r.createPayment),a.put("/updatepaymentstatus/:paymentId",r.updatePaymentStatus),a.post("/createpayment/:orderId",r.addPayment),e.exports=a},1218:(e,t,s)=>{const a=s(6860),r=(a(),a.Router()),d=s(3824),{Authentication:n,AuthenticationCustomer:o}=s(3350),{AddProductRole:i,AllProductRole:u,verifyProudct:l,outOfStockProduct:c}=s(3166),{exportIDs:m,exportProductAddDemoSheet:p,csvToJson:g}=s(6791);r.post("/product",n,d.addProduct),r.get("/products",n,d.getAllProducts),r.get("/allproducts",n,d.getAllProductsForFilter),r.get("/dashboardproduct",o,d.getAllProductsForDashboard),r.get("/product/:productId",d.getProductById),r.patch("/changeproductstatus/:productId",n,d.changeProductStatus),r.patch("/changeproductstockstatus/:productId",n,d.changeProductStockStatus),r.put("/updateproduct/:productId",n,d.updateProduct),r.get("/downloadDependencies",n,m),r.get("/downloadprodctxlsx",n,p),r.post("/bulkproductupload",n,g),e.exports=r},900:(e,t,s)=>{const a=s(6860).Router(),{Authentication:r}=s(3350),{updateProfile:d,changePassword:n}=s(6094);a.put("/update-userprofile",r,d),a.post("/changePassword",n),e.exports=a},1005:(e,t,s)=>{const a=s(6860).Router(),r=s(6082),{Authentication:d}=(s(6548),s(3350));a.post("/addquestion",d,r.addQuestions),a.get("/getallquestion",d,r.getAllQuestion),a.get("/getallquestionbyuser",d,r.getAllQuestionByModel),a.delete("/delete-question-byid/:questionid",d,r.deleteQuestionById),e.exports=a},928:(e,t,s)=>{const a=s(6860),{getOrderReport:r,exportSaleReport:d,exportPurchaseReport:n,getPaymentReport:o,updatePaymentReport:i}=s(8506),{Authentication:u}=s(3350),l=a.Router();l.get("/order-report",u,r),l.post("/export-sale-report",u,d),l.post("/export-purchase-report",u,n),l.get("/payment-report",u,o),l.put("/update-payment-report/:orderid",u,i),e.exports=l},4742:(e,t,s)=>{const a=s(6860).Router(),r=s(9062),{Authentication:d}=s(3350);a.post("/addvendor",r.addVendor),a.get("/allvendors",r.getAllVendors),a.post("/create-vendor-by-admin",d,r.createVendorByAdmin),a.put("/update-vendor-by-admin/:vendorId",d,r.updateVendor),e.exports=a},144:(e,t,s)=>{const a=s(6860),{addToWishlist:r,removeFromWishlist:d,getWishlistProduct:n}=s(4939),{AuthenticationCustomer:o}=s(3350),i=a.Router();i.post("/add-to-wishlist",o,r),i.delete("/remove-from-wishlist/:wishlistId",o,d),i.get("/get-wishlist",o,n),e.exports=i},4289:e=>{e.exports={isExpiryCoupon:e=>{let t=e.getDate(),s=e.getMonth()+1,a=e.getFullYear(),r=new Date(`${a}-${s<10?"0"+s:s}-${t<10?"0"+t:t}`).getTime()/1e3,d=(Date.now(),new Date),n=`${d.getFullYear()}-${d.getMonth()+1<10?"0"+(d.getMonth()+1):d.getMonth()+1}-${d.getDate()<10?"0"+d.getDate():d.getDate()}`;return!(new Date(n).getTime()/1e3<=r)}}},4394:e=>{e.exports={dateToLocalDate:e=>{let t=e.getDate(),s=e.getMonth()+1;return t=t<10?"0"+t:t,s=s<10?"0"+s:s,`${t}/${s}/${e.getFullYear()}`},dateToLocalDateTime:e=>{let t=e.getDate(),s=e.getMonth()+1,a=e.getFullYear(),r=e.getHours(),d=e.getMinutes(),n=r<12?"AM":"PM";return r%=12,r=r||12,r=r<10?"0"+r:r,d=d<10?"0"+d:d,t=t<10?"0"+t:t,s=s<10?"0"+s:s,`${t}/${s}/${a} ${r}:${d} ${n}`}}},489:e=>{let t={MANAGE_MENU:{ADD_CATEGORY:"ADD_CATEGORY",ADD_SUBCATEGORY:"ADD_SUBCATEGORY"},MANAGE_PRODUCT:{ADD_PRODUCT:"ADD_PRODUCT",ALL_PRODUCT:"ALL_PRODUCT",PRODUCT_COLOR:"PRODUCT_COLOR",PRODUCT_SIZE:"PRODUCT_SIZE",BRAND:"BRAND",OUT_OF_STOCK_PRODUCTS:"OUT_OF_STOCK_PRODUCTS",PRODUCT_REVIEW:"PRODUCT_REVIEW"},MANAGE_ORDERS:{ALL_ORDERS:"ALL_ORDERS",CONFIRM_ORDERS:"CONFIRM_ORDERS",SHIPPED_ORDER:"SHIPPED_ORDER",PICKUP_PENDING:"PICKUP_PENDING",DELIVERED_ORDER:"DELIVERED_ORDER",RTO_ORDER:"RTO_ORDER",RTO_DELIVERED:"RTO_DELIVERED",CANCEL_ORDER:"CANCEL_ORDER",PARTIAL_DELIVERED:"PARTIAL_DELIVERED",HOLD:"HOLD",PICKUP_INITIATE:"PICKUP_INITIATE"},IMPORT_PINCODE:"IMPORT_PINCODE",MANAGE_RETURN:{RETURN_REQUEST:"RETURN_REQUEST",SETTLEMENT_REQUEST:"SETTLEMENT_REQUEST",REFUNDED:"REFUNDED",SETTLEMENT_REQUEST_CANCEL:"SETTLEMENT_REQUEST_CANCEL"},ALL_USERS:"ALL_USERS",MANAGE_COUPONS:{ADD_COUPON:"ADD_COUPON",ALL_COUPON:"ALL_COUPON"},MANAGE_SALES:"MANAGE_SALES",HOMEPAGE_MANAGE:"HOMEPAGE_MANAGE",MANAGE_VENDOR:{ADD_VENDOR:"ADD_VENDOR",ALL_VENDOR:"ALL_VENDOR",ALL_OUTSTANDING:"ALL_OUTSTANDING",ALL_SETTLED:"ALL_SETTLED"},ADD_EMPLOYEE:"ADD_EMPLOYEE",EXPORT_INFORMATION:"EXPORT_INFORMATION"},s={ORDERS:{ACCESS:{ORDERS_VIEW:!1,ORDERS_EDIT:!1,ORDERS_DOWNLOAD:!1},ORDERS_ALL_ORDERS:"ALL_ORDERS",ORDERS_CHANGE_ORDER_STATUS:"CHANGE_ORDER_STATUS",ORDERS_ABANDONED_ORDERS:"ABANDONED_ORDERS"},COUPON:{ACCESS:{COUPON_VIEW:!1,COUPON_EDIT:!1,COUPON_DOWNLOAD:!1},COUPON_ALL_COUPON:"ALL_COUPON",COUPON_ADD_NEW_COUPON:"ADD_NEW_COUPON"},PRODUCT:{ACCESS:{PRODUCT_VIEW:!1,PRODUCT_EDIT:!1,PRODUCT_DOWNLOAD:!1},PRODUCT_ALL_PRODUCT:"ALL_PRODUCT",PRODUCT_ADD_PRODUCT:"ADD_PRODUCT"},VENDOR:{ACCESS:{VENDOR_VIEW:!1,VENDOR_EDIT:!1,VENDOR_DOWNLOAD:!1},VENDOR_ALL_VENDOR:"ALL_VENDOR",VENDOR_ADD_VENDOR:"ADD_VENDOR",VENDOR_VENDOR_PAYMENT:"VENDOR_PAYMENT",VENDOR_VENDOR_MOV:"VENDOR_MOV"},CUSTOMER:{ACCESS:{CUSTOMER_VIEW:!1,CUSTOMER_EDIT:!1,CUSTOMER_DOWNLOAD:!1},CUSTOMER_ALL_CUSTOMER:"ALL_CUSTOMER",CUSTOMER_CUSTOMER_ORDER_BY_PHONE:"CUSTOMER_ORDER_BY_PHONE"},SETTING:{SETTING_BUSINESS_INFO_SETTING:"BUSINESS_INFO_SETTING",SETTING_HOMEPAGE_SETTING:"HOMEPAGE_SETTING"},REPORT:{ACCESS:{REPORT_VIEW:!1,REPORT_DOWNLOAD:!1}},SUB_ADMIN:{ACCESS:{SUBADMIN_VIEW:!1,SUBADMIN_DOWNLOAD:!1},SUB_ADMIN_ALL_ADMIN:"ALL_ADMIN",SUB_ADMIN_ADD_ADMIN:"ADD_ADMIN"}};e.exports={roleEnums:t,listOfRoleEnums:()=>{let e=["ADMIN"];for(let s in t)"string"==typeof t[s]?e.push(t[s]):e=[...e,...Object.values(t[s]).flat()];return e},accessControls:s,listOfAccessControll:()=>{let e=["ADMIN"];for(let t of Object.keys(s))if("string"!=typeof s[t])for(let a of Object.keys(s[t]))if("string"!=typeof s[t][a])for(let r of Object.keys(s[t][a]))e.push(r);else e.push(a);return e}}},1293:(e,t,s)=>{const a=s(8018);var r=s(2097),d=s(7147);const n=s(1017);e.exports={generatePdf:async(e,t)=>{const s=n.resolve("invoice.hbs"),o=d.readFileSync(s,"utf8");let i=r.compile(o)(e);const u=await a.launch({headless:"new"}),l=await u.newPage();await l.setContent(i),await l.addStyleTag({content:".pageNumbers { content: counter(page) }"});let c=await l.pdf({format:"A4",printBackground:!0,displayHeaderFooter:!0,footerTemplate:`<div style='width:100%; font-size:10px; text-align: end; font-weight: 600; padding-right:20px'>${t}<span style="margin-left:5px;"><span class='pageNumber'></span><span>/</span><span class='totalPages'></span></span></div>`});return await u.close(),c}}},1458:e=>{e.exports={financialYear:()=>{let e=new Date,t=e.getFullYear(),s="";return s=e.getMonth()+1<4?t-1:t,s.toString().slice(2)}}},5784:e=>{const t=(e,t)=>Number(e)*Number(t)/100;e.exports={percentage:t,calculateMarginAndSelling:(e,s,a)=>{if(0===Number(e))return 0;let r=Number(e);if(0===Number(s))return Number(r.toFixed(2));{let e=t(r,s)+r,d=t(e,a)+Number(e);return Number(d.toFixed(2))}}}},8357:e=>{e.exports={stateAndCode:{"Himachal Pradesh":"02",Punjab:"03",Chandigarh:"04",Uttarakhand:"05",Haryana:"06",Delhi:"07",Rajasthan:"08","Uttar Pradesh":"09",Bihar:"10",Sikkim:"11","Arunanchal Pradesh":"12",Nagaland:"13",Manipur:"14",Mizoram:"15",Tripura:"16",Meghalaya:"17",Assam:"18","West Bengal":"19",Jharkhand:"20",Odisha:"21",Chattisgarh:"22","Madhya Pradesh":"23",Gujarat:"24","Dadra And Nagar Haveli And Daman And  Diu":"26",Maharashtra:"27",Karnataka:"29",Goa:"30",Lakshadweep:"31",Kerela:"32","Tamil Nadu":"33",Puducherry:"34","Andaman and Nicobar Islands":"35",Telangana:"36","Andhra Pradesh":"37",Ladakh:"38","Other Territory":"97"}}},5484:(e,t,s)=>{const a=s(1185).Types.ObjectId;e.exports={isValidRequestBody:e=>Object.keys(e).length>0,isValidObjectId:e=>!!a.isValid(e),isValid:e=>void 0!==e&&null!==typeof e&&("string"!=typeof e||0!=e.trim().length),isValidName:function(e){return/^[A-Za-z\s]{1,}[A-Za-z\s]{0,}$/.test(e)},isValidEmail:function(e){return/^\w+([\.-]?\w+)@\w+([\.-]?\w+)(\.\w{2,6})+$/.test(e)},isValidImg:e=>/image\/png|image\/jpeg|image\/jpg/.test(e),isValidPassword:function(e){return/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,15}$/.test(e)},isValidMoblie:function(e){return/^(?:(?:\+|0{0,2})91(\s*|[\-])?|[0]?)?([6789]\d{2}([-]?)\d{3}([-]?)\d{4})$/.test(e)},isValidGST:function(e){return/\d{2}[A-Z]{5}\d{4}[A-Z]{1}[A-Z\d]{1}[Z]{1}[A-Z\d]{1}/.test(e)},isValidPrice:function(e){return/^\d+(?:[.,]\d+)*$/.test(e)},isValidStatus:function(e){return-1!=["pending","completed","cancled"].indexOf(e)},isValidPin:function(e){return/^[1-9]{1}[0-9]{2}\\s{0, 1}[0-9]{3}$/.test(e)}}},9336:e=>{"use strict";e.exports=require("aws-sdk")},4588:e=>{"use strict";e.exports=require("aws-sdk/lib/maintenance_mode_message")},2167:e=>{"use strict";e.exports=require("axios")},7096:e=>{"use strict";e.exports=require("bcrypt")},3986:e=>{"use strict";e.exports=require("body-parser")},7101:e=>{"use strict";e.exports=require("convert-csv-to-json")},3582:e=>{"use strict";e.exports=require("cors")},8160:e=>{"use strict";e.exports=require("csvtojson")},5142:e=>{"use strict";e.exports=require("dotenv")},7641:e=>{"use strict";e.exports=require("exceljs")},6860:e=>{"use strict";e.exports=require("express")},6674:e=>{"use strict";e.exports=require("express-fileupload")},4324:e=>{"use strict";e.exports=require("firebase/app")},1668:e=>{"use strict";e.exports=require("firebase/storage")},2097:e=>{"use strict";e.exports=require("handlebars")},9344:e=>{"use strict";e.exports=require("jsonwebtoken")},6517:e=>{"use strict";e.exports=require("lodash")},1185:e=>{"use strict";e.exports=require("mongoose")},8018:e=>{"use strict";e.exports=require("puppeteer")},8910:e=>{"use strict";e.exports=require("request")},3673:e=>{"use strict";e.exports=require("slugify")},7202:e=>{"use strict";e.exports=require("twilio")},7147:e=>{"use strict";e.exports=require("fs")},1017:e=>{"use strict";e.exports=require("path")}},t={};function s(a){var r=t[a];if(void 0!==r)return r.exports;var d=t[a]={exports:{}};return e[a](d,d.exports,s),d.exports}(()=>{const e=s(6860),t=s(1185),a=s(3986),r=s(6674),d=(s(1017),s(3582)),n=e();s(5142).config();const o=s(1218),i=s(882),u=s(5806),l=s(4742),c=s(9683),m=s(6461),p=s(8),g=s(4643),y=s(4965),_=s(8783),f=s(1005),h=s(4632),I=s(8908),A=s(4933),b=s(1670),S=s(1399),N=s(384),D=s(900),v=s(928),w=s(2996),E=s(144),C=s(534),{mongoDbUrl:O,port:T}=s(341);n.use(e.json()),n.use(r()),n.use(e.urlencoded({extended:!0})),n.use(a.json()),n.use(d()),t.connect(O,{useNewUrlParser:!0}).then((()=>console.log("Connected with Database"))).catch((e=>console.log(e))),n.use("/",o),n.use("/",i),n.use("/",u),n.use("/",l),n.use("/",c),n.use("/",m),n.use("/",p),n.use("/",g),n.use("/",y),n.use("/",_),n.use("/",f),n.use("/",h),n.use("/",I),n.use("/",A),n.use("/",b),n.use("/",S),n.use("/",N),n.use("/",D),n.use("/",v),n.use("/",w),n.use("/",E),n.use("/",C),n.get("/",((e,t)=>{t.send("<h1>factorez.com backend deployed successfully</h1>")})),n.listen(T,(()=>console.log(`Server is up and running on port: ${T}`)))})()})();
//# sourceMappingURL=index.js.map